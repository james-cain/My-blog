<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Interview | Jamescain Blog</title>
    <meta name="description" content="A knowledge blog">
    <link rel="icon" href="/knowledge-note/favicon.ico">
    
    <link rel="preload" href="/knowledge-note/assets/css/0.styles.44e21d02.css" as="style"><link rel="preload" href="/knowledge-note/assets/js/app.a571e02f.js" as="script"><link rel="preload" href="/knowledge-note/assets/js/18.6f16dec0.js" as="script"><link rel="prefetch" href="/knowledge-note/assets/js/19.c37ef0c0.js"><link rel="prefetch" href="/knowledge-note/assets/js/2.cda51ec0.js"><link rel="prefetch" href="/knowledge-note/assets/js/3.6caa4f71.js"><link rel="prefetch" href="/knowledge-note/assets/js/4.81837870.js"><link rel="prefetch" href="/knowledge-note/assets/js/5.4abe3e4f.js"><link rel="prefetch" href="/knowledge-note/assets/js/6.a10385b4.js"><link rel="prefetch" href="/knowledge-note/assets/js/7.a491225e.js"><link rel="prefetch" href="/knowledge-note/assets/js/8.f2980765.js"><link rel="prefetch" href="/knowledge-note/assets/js/9.ce76167c.js"><link rel="prefetch" href="/knowledge-note/assets/js/10.9fb009fc.js"><link rel="prefetch" href="/knowledge-note/assets/js/11.bc65059e.js"><link rel="prefetch" href="/knowledge-note/assets/js/12.669a327f.js"><link rel="prefetch" href="/knowledge-note/assets/js/13.0bdf7f86.js"><link rel="prefetch" href="/knowledge-note/assets/js/14.a9b555b9.js"><link rel="prefetch" href="/knowledge-note/assets/js/15.2b1887a3.js"><link rel="prefetch" href="/knowledge-note/assets/js/16.44d5feba.js"><link rel="prefetch" href="/knowledge-note/assets/js/17.2b5e8c6e.js"><link rel="prefetch" href="/knowledge-note/assets/js/20.2a764e2b.js"><link rel="prefetch" href="/knowledge-note/assets/js/21.e5945440.js"><link rel="prefetch" href="/knowledge-note/assets/js/22.89cbd53a.js"><link rel="prefetch" href="/knowledge-note/assets/js/23.083f87bd.js"><link rel="prefetch" href="/knowledge-note/assets/js/24.d6db099f.js"><link rel="prefetch" href="/knowledge-note/assets/js/25.305e737e.js"><link rel="prefetch" href="/knowledge-note/assets/js/26.32f2986f.js"><link rel="prefetch" href="/knowledge-note/assets/js/27.75103a1d.js"><link rel="prefetch" href="/knowledge-note/assets/js/28.e322ff7c.js"><link rel="prefetch" href="/knowledge-note/assets/js/29.57b07e92.js"><link rel="prefetch" href="/knowledge-note/assets/js/30.edb680ca.js"><link rel="prefetch" href="/knowledge-note/assets/js/31.9d28451c.js"><link rel="prefetch" href="/knowledge-note/assets/js/32.145cb0e7.js"><link rel="prefetch" href="/knowledge-note/assets/js/33.1c00a16b.js"><link rel="prefetch" href="/knowledge-note/assets/js/34.1628add9.js"><link rel="prefetch" href="/knowledge-note/assets/js/35.d2c17cf5.js"><link rel="prefetch" href="/knowledge-note/assets/js/36.92610b6b.js"><link rel="prefetch" href="/knowledge-note/assets/js/37.4a523ed6.js"><link rel="prefetch" href="/knowledge-note/assets/js/38.4b9f3dd3.js"><link rel="prefetch" href="/knowledge-note/assets/js/39.dac86e16.js">
    <link rel="stylesheet" href="/knowledge-note/assets/css/0.styles.44e21d02.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-note/" class="home-link router-link-active"><!----> <span class="site-name">Jamescain Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-note/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-note/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-html5.html" class="sidebar-link">html5</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-CSS3.html" class="sidebar-link">CSS3</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/knowledge-note/knowledge/review-the-javascript.html" class="sidebar-link">ES6</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html" class="active sidebar-link">Interview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#基本类型" class="sidebar-link">基本类型</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#浮点数的坑" class="sidebar-link">浮点数的坑</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#值类型和引用类型" class="sidebar-link">值类型和引用类型</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#强转换" class="sidebar-link">强转换</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#typeof" class="sidebar-link">typeof</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#instanceof" class="sidebar-link">instanceof</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#this、this-箭头函数-、call、apply、bind" class="sidebar-link">this、this(箭头函数)、call、apply、bind</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#作用域" class="sidebar-link">作用域</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#函数式编程" class="sidebar-link">函数式编程</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#js表达式-expressions-与语句-statements" class="sidebar-link">JS表达式(expressions)与语句(statements)</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#变量提升" class="sidebar-link">变量提升</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#promise" class="sidebar-link">Promise</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#立即执行函数，模块化，命名空间" class="sidebar-link">立即执行函数，模块化，命名空间</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#递归" class="sidebar-link">递归</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#混合对象类" class="sidebar-link">混合对象类</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#消息队列和事件循环" class="sidebar-link">消息队列和事件循环</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#多进程浏览器" class="sidebar-link">多进程浏览器</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#object-assign" class="sidebar-link">Object.assign()</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#object-create" class="sidebar-link">Object.create()</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#object-defineproperty" class="sidebar-link">Object.defineProperty()</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#类型化数组-typed-arrays" class="sidebar-link">类型化数组(Typed Arrays)</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#memoization" class="sidebar-link">Memoization</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#原码、反码、补码、移码" class="sidebar-link">原码、反码、补码、移码</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#字符编码" class="sidebar-link">字符编码</a></li><li class="sidebar-sub-header"><a href="/knowledge-note/knowledge/Damn-hole-of-interview.html#算法" class="sidebar-link">算法</a></li></ul></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-design-patterns.html" class="sidebar-link">设计模式</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-http.html" class="sidebar-link">http/http2/https</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-common-plugin.html" class="sidebar-link">常用插件包问题</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-webapi.html" class="sidebar-link">WebAPI</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-Browser.html" class="sidebar-link">Browser</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-IE9.html" class="sidebar-link">IE9 兼容性</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-nodejs.html" class="sidebar-link">nodejs</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-mobile-compatibility.html" class="sidebar-link">mobile 兼容性</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-google-devtools.html" class="sidebar-link">google devtools</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-network.html" class="sidebar-link">网络</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-safe-and-hacker.html" class="sidebar-link">网络安全</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-javascript-algonithms.html" class="sidebar-link">JavaScript算法</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-performance.html" class="sidebar-link">性能优化</a></li><li><a href="/knowledge-note/knowledge/parameters-of-package.html" class="sidebar-link">详解package.json</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-babel.html" class="sidebar-link">babel7</a></li><li><a href="/knowledge-note/knowledge/webpack-perf.html" class="sidebar-link">Webpack打包优化</a></li><li><a href="/knowledge-note/knowledge/webpack-source-learning.html" class="sidebar-link">webpack源码</a></li><li><a href="/knowledge-note/knowledge/how-to-use-npm-sonatype.html" class="sidebar-link">用sonatype3搭建npm私服</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>拓展</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-pwa.html" class="sidebar-link">PWA</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>源码分析</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/Damn-hole-of-mvvm.html" class="sidebar-link">MVVM</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-React.html" class="sidebar-link">React</a></li><li><a href="/knowledge-note/knowledge/Damn-hole-of-Vue.html" class="sidebar-link">Vue</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/knowledge-note/knowledge/server-record.html" class="sidebar-link">部署一台属于自己的服务器</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="interview"><a href="#interview" aria-hidden="true" class="header-anchor">#</a> Interview</h1> <h2 id="基本类型"><a href="#基本类型" aria-hidden="true" class="header-anchor">#</a> 基本类型</h2> <p>string、number、boolean、null、undefined、Symbol</p> <p>除了null和undefined之外，所有基本类型都有包裹这个基本类型值的等价对象：</p> <p>String、Number、Boolean、Symbol，对象的valueOf()方法返回基本类型值</p> <h2 id="浮点数的坑"><a href="#浮点数的坑" aria-hidden="true" class="header-anchor">#</a> 浮点数的坑</h2> <p><img src="http://reyshieh.com/assets/float-hole.png" alt="float-hole"></p> <p>想必以上的输出程序员在编写代码的时候都见过，这就是浮点数运算的锅。</p> <p>在JavaScript中，浮点数是采用IEEE-754格式定义的，即双精度格式，每个浮点数占<strong>64位</strong>，包括整数。</p> <p>其中，第1位为<strong>标记位</strong>，表示正数或负数。中间11位表示<strong>指数</strong>，允许指数最大到<strong>2047</strong>（0-2047），如果指数部分的值在0到2047之间（不含两个端点），那么有效数字的第一位默认总是1^?^，不保存在64位浮点数之中，也就是，有效数字这时总是<strong>1.xx…xx</strong>的形式，其中<strong>xx…xx</strong>的部分保存在64位浮点数之中，最长可能为52位，因此，<strong>JavaScript提供的有效数字最长为53个二进制位</strong>。剩下52位是<strong>尾数(有效数字)</strong>，也就是允许精度到52位以后。因此，不难看出，Javascript中是存在+0和-0的，Infinity和NaN也被编码为浮点数，指数取最大值，尾数为0，它表示为正无穷或负无限。</p> <div class="language- extra-class"><pre class="language-text"><code>(-1)^符号位 * 1.xx...xx * 2^指数部分
</code></pre></div><p>该公式是正常情况下(指数部分在0到2047之间)，一个数在JavaScript内部实际的表示形式</p> <p>对于不理解浮点数在计算机中是如何表示，可以通过<a href="http://www.binaryconvert.com/convert_double.html" target="_blank" rel="noopener noreferrer">IEEE754 64-bit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可视化界面来帮助理解~</p> <p>精度最多只能到53个二进制位，意味着，绝对值小于2的53次方的整数，即-2^53^到2^53^，都可以精确表示</p> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>
<span class="token comment">// 9007199254740992</span>
 
Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token comment">// 9007199254740992</span>

Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span>
<span class="token comment">// 9007199254740994</span>

Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span>
<span class="token comment">// 9007199254740996</span>

Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span>
<span class="token comment">// 9007199254740996</span>
</code></pre></div><p>由于2的53次方是一个16位的十进制数值，所以，换句话说，<strong>JavaScript对15位的十进制数都可以精确处理</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>
<span class="token comment">// 9007199254740992</span>

<span class="token comment">// 多出的三个有效数字，将无法保存</span>
<span class="token number">9007199254740992111</span>
<span class="token comment">// 9007199254740992000</span>
</code></pre></div><p>JavaScript在几种情况下，<strong>会自动将数值转为科学计数法表示，其他情况都采用字面形式直接表示</strong>：</p> <ol><li><p>小数点前的数字多与21位</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1234567890123456789012</span>
<span class="token comment">// 1.2345678901234568e+21</span>

<span class="token number">123456789012345678901</span>
<span class="token comment">// 123456789012345680000</span>
</code></pre></div></li> <li><p>小数点后的零多余5个</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 小数点后紧跟5个以上的零，</span>
<span class="token comment">// 就自动转为科学计数法</span>
<span class="token number">0.0000003</span> <span class="token comment">// 3e-7</span>

<span class="token comment">// 否则，就保持原来的字面形式</span>
<span class="token number">0.000003</span> <span class="token comment">// 0.000003</span>
</code></pre></div></li></ol> <p>指数用11个二进制位，分成一半负数，[0,1022]表示负数(阶码对应为-1023~-1)，[1024-2047]表示正数(阶码对应为1~1024)。1023(01111111111)实际代码阶码为0，也就是JavaScript能表示的数值范围为2^1024^到2^-1023^（开区间）之间，超出的数无法表示。</p> <blockquote><p>浮点数的阶码是用移码计算的，即对真值补码的符号位取反</p> <p>正整数的符号位0，反码和补码等同于原码</p> <p>负整数符号位固定为1，原码，反码和补码的表示都不相同，有原码表示法变成反码和补码的规则如下：</p> <ol><li>原码符号位为1不变，整数的每一位二进制数位求反得反码</li> <li>反码符号位为1不变，反码数值位最低位加1得补码</li></ol></blockquote> <p>实际公式为:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">V</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token constant">S</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token operator">-</span><span class="token number">1023</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.</span><span class="token constant">M</span><span class="token punctuation">)</span>
<span class="token comment">// S:符号位</span>
<span class="token comment">// E: 指数位</span>
<span class="token comment">// M: 尾数位，超出的部分自动进一舍零</span>

<span class="token comment">// 双精度浮点数，阶码的计算 E-1023,其中1023是由移码计算得来，即符号位为0，其他位数都为1，</span>
<span class="token comment">// 因此不难看出，单精度浮点数，阶码的计算则为 E-2^7 === E-127</span>
<span class="token comment">// 所以，单精度浮点数的表示公式为</span>
<span class="token comment">// V = (-1)^S * 2^(E-127) * (1.M)</span>
</code></pre></div><p>如果一个数大于等于2的1024次方，那么就会发生&quot;正向溢出&quot;，即JavaScript无法表示这么大的数，这时会返回Infinity</p> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// Infinity</span>
</code></pre></div><p>如果一个数小于2的-1075次方（指数部分最小值-1023，再加上小数部分的52位），那么就是&quot;负向溢出&quot;，即JavaScript无法表示这么小的数，这时会直接返回0</p> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1075</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
</code></pre></div><p><strong>特殊数值</strong></p> <ul><li><p>正零和负零</p> <p>在正常的场合，正零和负零都会被当做正常的0</p> <p>只有在把+0和-0当做分母，返回的值才是不相等的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// false, +Infinity和-Infinity</span>
</code></pre></div></li> <li><p>NaN</p> <p>主要出现在字符串解析成数字出错的场合</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">5</span> <span class="token operator">-</span> <span class="token string">'x'</span> <span class="token comment">// NaN</span>
</code></pre></div><p>一些数学函数的运算结果也会出现NaN，如Math.acos(2)，Math.log(-1)，Math.sqrt(-1)等</p> <p><strong>0除以0也会得到NaN</strong></p> <p>NaN不是独立的数据类型，而是一个特殊数据值，<strong>它的数据类型依然属于Number</strong>，使用typeof运算符可以看得出来</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token number">NaN</span> <span class="token comment">// 'number'</span>
</code></pre></div><p>NaN不等于任何值，包括它本身</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span> <span class="token comment">// false</span>
</code></pre></div><p>数组的<strong>indexOf</strong>方法内部使用的是严格相等运算符，所以该方法对NaN不成立</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token number">NaN</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// -1</span>
</code></pre></div><p>NaN在布尔运算时被当做false</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div></li> <li><p>Infinity</p> <p>“无穷”，用来表示两种场景。一种是一个正的数值太大，或一个负的数值太小，无法表示；另一种是非0数值除以0，得到Infinity</p> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// Infinity</span>

<span class="token number">0</span> <span class="token operator">/</span> <span class="token number">0</span> <span class="token comment">// NaN</span>
<span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span> <span class="token comment">// Infinity</span>
</code></pre></div><p>Infinity大于一切数值(除了NaN)，-Infinity小于一切数值(除了NaN)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">Infinity</span> <span class="token operator">&gt;</span> <span class="token number">1000</span> <span class="token comment">// true</span>
<span class="token operator">-</span><span class="token number">Infinity</span> <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1000</span> <span class="token comment">// true</span>
</code></pre></div><p>Infinity与NaN比较，总是返回false</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">Infinity</span> <span class="token operator">&gt;</span> <span class="token number">NaN</span> <span class="token comment">// false</span>
<span class="token operator">-</span><span class="token number">Infinity</span> <span class="token operator">&gt;</span> <span class="token number">NaN</span> <span class="token comment">// false</span>
</code></pre></div><p>0乘以Infinity，返回NaN；0除以Infinity，返回0；Infinity除以0，返回Infinity</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0</span> <span class="token operator">*</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
<span class="token number">0</span> <span class="token operator">/</span> <span class="token number">Infinity</span> <span class="token comment">// 0</span>
<span class="token number">Infinity</span> <span class="token operator">/</span> <span class="token number">0</span> <span class="token comment">// Infinity</span>
</code></pre></div><p>Infinity加或乘以Infinity，返回的还是Infinity</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">Infinity</span> <span class="token operator">+</span> <span class="token number">Infinity</span> <span class="token comment">// Infinity</span>
<span class="token number">Infinity</span> <span class="token operator">*</span> <span class="token number">Infinity</span> <span class="token comment">// Infinity</span>
</code></pre></div><p>Infinity减或除以Infinify，得到NaN</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">Infinity</span> <span class="token operator">-</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
<span class="token number">Infinity</span> <span class="token operator">/</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
</code></pre></div><p>Infinity与null计算时，<strong>null会转成0</strong>，等同于与0计算</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">null</span> <span class="token operator">*</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
<span class="token keyword">null</span> <span class="token operator">/</span> <span class="token number">Infinity</span> <span class="token comment">// 0</span>
<span class="token number">Infinity</span> <span class="token operator">/</span> <span class="token keyword">null</span> <span class="token comment">// Infinity</span>
</code></pre></div><p>Infinity与undefined计算都是NaN</p> <div class="language-js extra-class"><pre class="language-js"><code>undefined <span class="token operator">+</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
undefined <span class="token operator">-</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
undefined <span class="token operator">*</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
undefined <span class="token operator">/</span> <span class="token number">Infinity</span> <span class="token comment">// NaN</span>
<span class="token number">Infinity</span> <span class="token operator">/</span> undefined <span class="token comment">// NaN</span>
</code></pre></div></li></ul> <p>推荐处理浮点数可以使用像<a href="https://github.com/josdejong/mathjs" target="_blank" rel="noopener noreferrer">mathjs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这样的库。</p> <blockquote><p>?: 为什么指数部分的值在0到2047之间（不含两个端点），那么有效数字的第一位默认总是1？</p> <p>在计算机中，二进制数值都会转换成对应的科学计数法表示。如4.5，转换成二进制是100.1，特学技术法表示是1.001 * 2^2，因此，不难看出，第1位，在非零情况下，都为1.</p></blockquote> <p>资料：https://github.com/camsong/blog/issues/9</p> <h2 id="值类型和引用类型"><a href="#值类型和引用类型" aria-hidden="true" class="header-anchor">#</a> 值类型和引用类型</h2> <p>值类型（string、number、boolean、null、undefined）</p> <ul><li>占用空间固定，保存在<strong>栈</strong>中（当一个方法执行时，每个方法都会建立自己的内存栈，在这个方法内定义的变量将会逐个放入这块栈内存里，随着方法的执行结束，这个方法的内存栈也将自然销毁。因此，所有在方法中定义的变量都是放在栈内存中的；<strong>栈中存储的是基础变量以及一些对象的引用变量，基础变量的值是存储在栈中，而引用变量存储在栈中的是指向堆中的数组或者对象的地址，因此，修改引用类型总会影响到其他指向这个地址的引用变量</strong>）</li> <li><strong>保存和复制的是值本身</strong></li> <li>使用typeof检测数据的类型</li> <li>基本类型数据是值类型</li></ul> <p>引用类型（object、array、function）</p> <ul><li>占用空间不固定，保存在<strong>堆</strong>中（当在程序中创建一个对象时，对象将被保存到运行时数据区中，以便反复利用，这个运行时数据区就是堆内存。堆内存中的对象不会随方法的结束而销毁，即使方法结束后，这个对象还可能被另一个引用变量引用，则这个对象依然不会被销毁，只有当一个对象没有任何引用变量引用时，系统的垃圾回收机制才会回收它）</li> <li><strong>保存与复制的是指向对象的一个指针</strong></li> <li>使用instanceof检测数据类型</li> <li>使用new()方法构造出的对象是引用型</li></ul> <h3 id="纯函数"><a href="#纯函数" aria-hidden="true" class="header-anchor">#</a> 纯函数</h3> <p>对于一个函数，给定一个输入，返回一个唯一的输出。除此之外，不会对外部环境产生任何附带影响，称为纯函数。所有函数内部定义的变量在函数返回之后都被垃圾回收掉。</p> <p>如果函数的输入是对象(Array、Function、Object)，虽然还是按值传递，但对于对象来说，应该说是<strong>按共享传递</strong>比较合适。实际传递的是该对象的副本，因此修改了该副本中某个值，还是会影响到对象本身。但如果对该对象直接替换，会导致找不到原值，而不会修改原值。</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 非纯函数</span>
<span class="token keyword">function</span> <span class="token function">changeAgelmpure</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> person<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> reyshieh <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'reyshieh'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">26</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> changedRey <span class="token operator">=</span> <span class="token function">changeAgelmpure</span><span class="token punctuation">(</span>reyshieh<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reyshieh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: 'reyshieh', age: 25}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>changedRey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: 'reyshieh', age: 25}</span>

<span class="token comment">// 纯函数</span>
<span class="token keyword">function</span> <span class="token function">changeAgeImpure</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newPersonObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newPersonObj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newPersonObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> reyshieh <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'reyshieh'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">26</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> changedRey <span class="token operator">=</span> <span class="token function">changeAgelmpure</span><span class="token punctuation">(</span>reyshieh<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reyshieh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: 'reyshieh', age: 26}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>changedRey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: 'reyshieh', age: 25}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">changeAgeAndReference</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span> <span class="token comment">// 此时还没有修改对象本身，修改属性后，影响原来的对象</span>
    person <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 修改了对象本身，不再具有引用关系</span>
    
    <span class="token keyword">return</span> person<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> personObj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Alex'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> personObj2 <span class="token operator">=</span> <span class="token function">changeAgeAndReference</span><span class="token punctuation">(</span>personObj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>personObj1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; ? {name: &quot;Alex&quot;, age: 25}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>personObj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; ? {name: &quot;John&quot;, age: 50}</span>
</code></pre></div><h2 id="强转换"><a href="#强转换" aria-hidden="true" class="header-anchor">#</a> 强转换</h2> <h3 id="隐式转换为布尔：-truthy-和-falsy"><a href="#隐式转换为布尔：-truthy-和-falsy" aria-hidden="true" class="header-anchor">#</a> 隐式转换为布尔：&quot;truthy&quot;和&quot;falsy&quot;</h3> <p>当转换布尔值时，任何值都可以被使用。以下这些值会被转换为false：</p> <ul><li>undefined，null</li> <li>Boolean：false</li> <li>Number：-0，+0，NaN</li> <li>String：''</li></ul> <p>所有其他值都会认为是true</p> <p>被转换成'false'的值称为falsy；被转换成'true'的值称为truthy</p> <h3 id="典型运算符操作结果"><a href="#典型运算符操作结果" aria-hidden="true" class="header-anchor">#</a> 典型运算符操作结果</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 比较</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// true 左边取toString取到空字符串再转数字得到0，右边被!强制转为boolean得到false再转数字</span>
<span class="token number">NaN</span> <span class="token operator">!==</span> <span class="token number">NaN</span> <span class="token comment">// true</span>
<span class="token boolean">false</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true boolean转数字，数组取toString得到空字符串再转数字</span>
<span class="token boolean">false</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// false boolean转数字，对象取valueOf得到空对象&quot;[object Object]&quot;</span>
<span class="token string">&quot;&quot;</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true 字符串转数字，数组取toString得到空字符串再转数字</span>
<span class="token string">&quot;&quot;</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// false 字符串转数字，对象取valueOf得到空对象&quot;[object Object]&quot;</span>
<span class="token string">&quot;&quot;</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true 数组取toString得到空字符串，转数字后得到0</span>
<span class="token number">0</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">;</span> <span class="token comment">// true '\n'即为''，转数字后得到0</span>
<span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token number">1</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token comment">// true</span>
<span class="token number">2</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token comment">// false</span>
<span class="token string">&quot;2&quot;</span> <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token comment">// flase</span>

<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false，null和undefined比较为true，null和1或0比较都为false</span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">==</span> undefined<span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">null</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token comment">// true</span>

<span class="token comment">// 加法</span>
<span class="token boolean">true</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// 1</span>
undefined <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// NaN</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// 1，这里的 {} 被当成了代码块</span>
<span class="token punctuation">{</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// 1</span>

obj <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// [object Object]1</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// Chrome 上显示 &quot;[object Object][object Object]&quot;，Firefox 显示 NaN</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// [object Object] []转为空字符串，{}转为字符串'[object Object]'</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> a <span class="token comment">// [object Object]</span>
<span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 等价于 + &quot;&quot; =&gt; 0</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 0 {}被当成空而无作用，+[]被强制转型为数字</span>
a <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// [object Object]</span>

<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// '2,31,2'</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// '21'</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// &quot;2-1&quot;</span>

<span class="token comment">// 减法或其他操作，无法进行字符串连接，因此在错误的字符串格式下返回 NaN</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// 1</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// NaN</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// -1</span>
</code></pre></div><h3 id="json的字符串化"><a href="#json的字符串化" aria-hidden="true" class="header-anchor">#</a> JSON的字符串化</h3> <p>JSON.stringify将值序列化为JSON字符串，和ToString有关，但并不等于强制转型</p> <ul><li>若为简单值，字符串、数字、boolean、null，规则和ToString相同</li> <li>若字符串中有非法值undefined、function、symbol、具有循环的对象，JSON.stringify会自动忽略这些非法值或抛出异常。若某个元素的值为非法值，则会自动转为null；若其中的一个属性为非法值(如function)，会排除这个属性</li> <li>若待转换的对象中带有<strong>toJSON方法</strong>，会优先调用该方法，并将该方法返回的值作为序列化的结果</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>undefined<span class="token punctuation">)</span> <span class="token comment">// undefined，忽略非法值</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// undefined，忽略非法值</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// undefined，忽略非法值</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> undefined<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[1,2,3,null]&quot;，非法值以 null 取代</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// &quot;{&quot;a&quot;:2}&quot;，忽略非法屬性</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 循环错误</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> someProperty<span class="token punctuation">:</span> <span class="token string">'Jack'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">{</span> anotherProperty<span class="token punctuation">:</span> a <span class="token punctuation">}</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: Converting circular structure to JSON</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: Converting circular structure to JSON</span>
</code></pre></div><p>toJSON e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> someObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 非法!</span>
  toJSON<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      a<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 序列化過程只包含 a 屬性</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>someObj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;{&quot;a&quot;:3}&quot;</span>
</code></pre></div><p>用toJSON解决循环错误</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    someProperty<span class="token punctuation">:</span> <span class="token string">'Jack'</span><span class="token punctuation">,</span>
    toJSON<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            prompt<span class="token punctuation">:</span> <span class="token string">'Hello World'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>
    anotherProperty<span class="token punctuation">:</span> a<span class="token punctuation">,</span>
    toJSON<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            prompt<span class="token punctuation">:</span> <span class="token string">'Hello World'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span>b <span class="token operator">=</span> b<span class="token punctuation">;</span>

<span class="token comment">// 序列化成功！不會被報錯了！</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// &quot;{&quot;prompt&quot;:&quot;Hello World&quot;}&quot;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// &quot;{&quot;prompt&quot;:&quot;Hello World&quot;}&quot;</span>
</code></pre></div><p>JSON.stringify可传入第二个选择性参数(取代器)来过滤需要序列化的属性</p> <ul><li><p>取代器是数组时，数组内的元素为指定要包含的属性名称。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// e.g.</span>
<span class="token keyword">const</span> someObj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>someObj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;{&quot;a&quot;: 2}&quot;</span>
</code></pre></div></li> <li><p>取代器是函数时，函数是用来返回需要做序列化的属性的值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> someObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>someObj<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &quot;{&quot;a&quot;:2}&quot;</span>
</code></pre></div></li></ul> <h3 id="tonumber"><a href="#tonumber" aria-hidden="true" class="header-anchor">#</a> ToNumber</h3> <p>规则</p> <ul><li><p>undefined -&gt; NaN</p></li> <li><p>null -&gt; +0 即0</p></li> <li><p>boolean true -&gt; 1 false -&gt; +0 即0</p></li> <li><p>string -&gt; NaN</p></li> <li><p><strong>object</strong>，尤其重要</p> <ul><li><strong>若有定义valueOf方法，优先使用valueOf取基本类型值</strong></li> <li><strong>若没有valueOF方法，则改用toString方法取得基本类型值，再用ToNumber转为数字</strong></li> <li><strong>Object.create(null)建立的null没有valueOf或toString方法</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Apple'</span><span class="token punctuation">,</span>
  valueOf<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'999'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 999</span>
</code></pre></div></li></ul> <h3 id="类型转换技巧"><a href="#类型转换技巧" aria-hidden="true" class="header-anchor">#</a> 类型转换技巧</h3> <ul><li><p>使用一元正/负运算符转换</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">+</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token comment">// 123</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token string">'-123'</span><span class="token punctuation">)</span> <span class="token comment">// 123</span>

<span class="token comment">// 用该方式将日期转换为时间戳，等价于Date.now()或.getTime()</span>
<span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
timestamp <span class="token comment">// 1539236301262</span>
</code></pre></div></li> <li><p>使用一元位元否定运算符(bitwise not, ~)</p> <p>该运算符用来进行二进制的补码运算(~x =&gt; -(x+1), 如 ~42 =&gt; -43)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`找到了，索引值原本是 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，被轉為 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">~</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`找不到，回傳結果原本是 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，被轉為 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">~</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'llo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 找到了，索引值原本是 2，被轉為 -3</span>
<span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span> <span class="token comment">// 找不到，回傳結果原本是 -1，被轉為 0</span>
</code></pre></div></li> <li><p>使用~~将浮点数转为整数</p> <p>其运算方式与运行两次~操作，同时截断小数的结果，类似!!的真假判断两次</p> <p>使用<strong>x | 0也可以得到与~~的结果相同</strong>，区别在于 ~~运算符的优先级更高，遇到四则运算时不用包括号</p> <p>它与<strong>Math.floor()运算的结果不同</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">29.8</span><span class="token punctuation">)</span> <span class="token comment">// -30</span>
<span class="token operator">~</span><span class="token operator">~</span><span class="token operator">-</span><span class="token number">29.8</span> <span class="token comment">// -29</span>
<span class="token operator">-</span><span class="token number">29.8</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token comment">// -29</span>
</code></pre></div></li></ul> <h3 id="关系比较"><a href="#关系比较" aria-hidden="true" class="header-anchor">#</a> 关系比较</h3> <p>规则</p> <ol><li><p>若一个是null，另一个是undefined，返回true</p></li> <li><p>若一个是null，另一个是非undefined和null，返回false</p></li> <li><p>若两个运算符都是字符串，直接依照字母顺序比较</p></li> <li><p>除了1，2，3点之外的状况，遵循以下</p></li></ol> <ul><li><strong>先使用ToPrimitive做强制转型-先使用valueOf取得值，再用toString方法转为字符串</strong></li> <li><strong>若有任一值转型后的结果不是字符串，就是用ToNumber的规则转为数字，来做数字上的比较</strong></li></ul> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'13'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

a <span class="token operator">&lt;</span> b <span class="token comment">// true, '12' &lt; '13'</span>
a <span class="token operator">&gt;</span> b <span class="token comment">// false</span>
</code></pre></div><p>下例比较有意思</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> b<span class="token punctuation">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">{</span> b<span class="token punctuation">:</span> <span class="token number">13</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

a <span class="token operator">&lt;</span> b <span class="token comment">// false, '[object Object]' &lt; '[object Object]'</span>
a <span class="token operator">&gt;</span> b <span class="token comment">// false，其实是比较b &lt; a， '[object Object]' &lt; '[object Object]'</span>
a <span class="token operator">==</span> b <span class="token comment">// false，其实是比较两实例的引用</span>

<span class="token comment">// 以下两个难以理解</span>
a <span class="token operator">&gt;=</span> b <span class="token comment">// true，其实是!(b &gt; a)，因此!false得到true</span>
a <span class="token operator">&lt;=</span> b <span class="token comment">// true</span>
</code></pre></div><h3 id="、-、object-is比较"><a href="#、-、object-is比较" aria-hidden="true" class="header-anchor">#</a> ==、===、Object.is比较</h3> <table><thead><tr><th>x</th> <th>y</th> <th><code>==</code></th> <th><code>===</code></th> <th><code>Object.is</code></th></tr></thead> <tbody><tr><td><code>undefined</code></td> <td><code>undefined</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td></tr> <tr><td><code>null</code></td> <td><code>null</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td></tr> <tr><td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td></tr> <tr><td><code>false</code></td> <td><code>false</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td></tr> <tr><td><code>&quot;foo&quot;</code></td> <td><code>&quot;foo&quot;</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td></tr> <tr><td><code>{ foo: &quot;bar&quot; }</code></td> <td><code>x</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td></tr> <tr><td><code>0</code></td> <td><code>0</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>true</code></td></tr> <tr><td><code>+0</code></td> <td><code>-0</code></td> <td><code>true</code></td> <td><code>true</code></td> <td><code>false</code></td></tr> <tr><td><code>0</code></td> <td><code>false</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>&quot;&quot;</code></td> <td><code>false</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>&quot;&quot;</code></td> <td><code>0</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>&quot;0&quot;</code></td> <td><code>0</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>&quot;17&quot;</code></td> <td><code>17</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>[1,2]</code></td> <td><code>&quot;1,2&quot;</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>new String(&quot;foo&quot;)</code></td> <td><code>&quot;foo&quot;</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>null</code></td> <td><code>undefined</code></td> <td><code>true</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>null</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>undefined</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>{ foo: &quot;bar&quot; }</code></td> <td><code>{ foo: &quot;bar&quot; }</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>new String(&quot;foo&quot;)</code></td> <td><code>new String(&quot;foo&quot;)</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>0</code></td> <td><code>null</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>0</code></td> <td><code>NaN</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>&quot;foo&quot;</code></td> <td><code>NaN</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>false</code></td></tr> <tr><td><code>NaN</code></td> <td><code>NaN</code></td> <td><code>false</code></td> <td><code>false</code></td> <td><code>true</code></td></tr></tbody></table> <h2 id="typeof"><a href="#typeof" aria-hidden="true" class="header-anchor">#</a> typeof</h2> <p>返回一个字符串，来表示数据的类型</p> <table><thead><tr><th>数据类型</th> <th>Type</th></tr></thead> <tbody><tr><td>Undefined</td> <td>&quot;undefined&quot;</td></tr> <tr><td>Null</td> <td>&quot;object&quot;</td></tr> <tr><td>布尔值</td> <td>&quot;boolean&quot;</td></tr> <tr><td>数值</td> <td>&quot;number&quot;</td></tr> <tr><td>字符串</td> <td>&quot;string&quot;</td></tr> <tr><td>Symbol</td> <td>&quot;symbol&quot;</td></tr> <tr><td>宿主对象（JS环境提供的，比如浏览器）</td> <td>Implementation-dependent</td></tr> <tr><td>函数对象</td> <td>&quot;function&quot;</td></tr> <tr><td>任何其他对象</td> <td>&quot;object&quot;</td></tr></tbody></table> <p>来几个e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 例1</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> x <span class="token operator">=</span> y <span class="token operator">=</span> <span class="token keyword">typeof</span> x<span class="token punctuation">;</span>
x<span class="token punctuation">;</span><span class="token comment">//&quot;undefined&quot;</span>
<span class="token comment">// 表达式是从右往左的，x由于变量提升，类型不是null，而是undefined，所以x=y=”undefined”</span>

<span class="token comment">// 例2</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&quot;number&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 传入的参数为f也就是function(){ return 1; }这个函数。通过f()执行后，得到结果1，所以typeof 1返回”number”</span>

<span class="token comment">// 例3</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  bar<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baz<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  baz<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&quot;undefined&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// this永远指向函数执行时的上下文，而不是定义时的（ES6的箭头函数不算）。当arguments执行时，this已经指向了window对象。所以是”undefined”</span>

<span class="token comment">// 例4</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  bar<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baz<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  baz<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token keyword">typeof</span> <span class="token punctuation">(</span>f <span class="token operator">=</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span>
<span class="token comment">// 同样是this的指向问题</span>

<span class="token comment">// 例5</span>
<span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">typeof</span> f<span class="token punctuation">;</span><span class="token comment">//&quot;number&quot;</span>
<span class="token comment">// 分组选择符，举例</span>
<span class="token comment">// var a = (1,2,3);</span>
<span class="token comment">// document.write(a);//3,会以最后一个为准</span>
<span class="token comment">// 因此上例实际是返回第二个函数</span>

<span class="token comment">// 例6</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  x <span class="token operator">+=</span> <span class="token keyword">typeof</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
x<span class="token punctuation">;</span><span class="token comment">//&quot;1undefined&quot;</span>
<span class="token comment">// 这是一个javascript语言规范上的问题，在条件判断中加入函数声明。这个声明语句本身没有错，也会返回true，但是javascript引擎在搜索的时候却找不到该函数。所以结果为”1undefined”</span>

<span class="token comment">// 例7</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token punctuation">{</span> bar<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
<span class="token comment">// 形参的foo指向的是{ foo: { bar: 1 } }这个整体</span>
</code></pre></div><p>typeof在两种情况下会返回&quot;undefined&quot;</p> <ul><li>变量没有被声明</li> <li>变量的值是<code>undefined</code></li></ul> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> undeclareVariable <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span> <span class="token comment">// true</span>

<span class="token keyword">var</span> declareVariable<span class="token punctuation">;</span>
<span class="token keyword">typeof</span> declareVariable <span class="token comment">// 'undefined'</span>

<span class="token keyword">typeof</span> undefined <span class="token comment">// 'undefined'</span>
</code></pre></div><p>但如果在一个未声明的变量上，直接判断当前值是否是undefined，就会抛出异常，因为只有<code>typeof</code>才可以正常检测未声明的变量的同时还不报错</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code>undeclareVariable <span class="token operator">===</span> undefined
<span class="token comment">// ReferenceError: undeclareVariable is not defined</span>
</code></pre></div><p>未初始化的变量，没有被传入参数的形参，不存在的属性，都不会出现上面的问题，因为它们总是可访问的，值总是<code>undefined</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> declaredVariable<span class="token punctuation">;</span>
declaredVariable <span class="token operator">===</span> undefined<span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">===</span> undefined <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// true</span>

<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo <span class="token operator">===</span> undefined
<span class="token comment">// true</span>
</code></pre></div><p>可以使用Object.prototype.toString来判断类型，判断的结果是准确的</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Number]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object String]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token string">'hi'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Object]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Array]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Boolean]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Function]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Null]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>undefined<span class="token punctuation">)</span> <span class="token comment">// &quot;[object Undefined]&quot;</span>

Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Symbol]&quot;</span>
</code></pre></div><h2 id="instanceof"><a href="#instanceof" aria-hidden="true" class="header-anchor">#</a> instanceof</h2> <p>伪代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">new_instance_of</span><span class="token punctuation">(</span>leftValue<span class="token punctuation">,</span> rightValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rightProto <span class="token operator">=</span> rightValue<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// 取右表达式的prototype值</span>
    leftValue <span class="token operator">=</span> leftValue<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>
    
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>leftValue <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>leftValue <span class="token operator">===</span> rightValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		leftValue <span class="token operator">=</span> leftValue<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际上，instanceof的主要实现原理就是对__ proto __ 和prototype的理解，下面有对这两个做分析</p> <h3 id="proto-和prototype"><a href="#proto-和prototype" aria-hidden="true" class="header-anchor">#</a> __ proto __和prototype</h3> <ul><li>方法(Function)是对象，方法的原型(Function.prototype)是对象。因此无论是方法还是方法的原型，都具有对象共有的特征</li> <li>对象在创建实例后，实例需要和对象构造函数原型产生引用，他们之间是通过__ proto __隐式指向的，这样实例就能够访问在构造函数原型中定义的属性和方法</li> <li>原型对象也有一个属性，constructor，这个属性包含一个指针，指回原构造函数</li></ul> <p>引用一张关系图（经典图，引自网络）</p> <p><img src="http://reyshieh.com/assets/prototype-and-proto.png" alt="prototype-and-proto"></p> <p>解释：</p> <ol><li><p>构造函数Foo() -- 构造函数的原型属性Foo.prototype指向了原型对象，在原型对象里共有的方法，所有构造函数声明的实例(如f1，f2)都可以共享方法</p></li> <li><p>原型对象Foo.prototype — 保存着实例共享的方法，有一个指针constructor指回构造函数</p></li> <li><p>实例 — f1和f2是Foo对象的两个实例，这两个对象也有属性__ proto __，指向构造函数的原型对象，这样就可以像1中所述访问原型对象的所有方法</p></li> <li><p>构造函数Foo()除了是方法，还是对象，也同样有__ proto __属性，会指向它的构造函数的原型对象，也就是Function。</p> <p>因此，__ proto __ 指向了Function.prototype</p></li> <li><p>逐级往上指向，再指向Object.prototype，最后Object.prototype的 __ proto __ 属性指向null</p></li></ol> <p>由该图，可以推断出</p> <div class="language-js extra-class"><pre class="language-js"><code>Object <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// true，由图可知，Object的prototype属性是Object.prototype，而由于Object本身是一个函数，由Function所创建，所以Object.__proto__的值是Function.prototype，而Function.prototype的__proto__属性是Object.prototype，所以可以判断出为true</span>
Function <span class="token keyword">instanceof</span> <span class="token class-name">Function</span> <span class="token comment">// true</span>
Function <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// true，由图可知，Foo函数的prototype属性时Foo.prototype，而Foo的__proto__属性是Function.prototype，而Function.prototype的__proto__属性并没有指向Foo.prototype，因此可以判断出为false</span>
Foo <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span> <span class="token comment">// false</span>
Foo <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// true</span>
Foo <span class="token keyword">instanceof</span> <span class="token class-name">Function</span> <span class="token comment">// true</span>
</code></pre></div><p>最后总结：</p> <ul><li><p>实例有属性__ proto __，指向该实例对应对象的构造函数的原型</p></li> <li><p>对象有属性__ proto __，还有属性prototype，prototype指向该对象的原型对象</p> <p>__ proto __指向对象构造函数的构造函数的原型</p></li></ul> <h2 id="this、this-箭头函数-、call、apply、bind"><a href="#this、this-箭头函数-、call、apply、bind" aria-hidden="true" class="header-anchor">#</a> this、this(箭头函数)、call、apply、bind</h2> <h3 id="this"><a href="#this" aria-hidden="true" class="header-anchor">#</a> this</h3> <p>永远指向最后调用它的那个对象，或理解为***运行时***所在的对象</p> <h3 id="this-箭头函数"><a href="#this-箭头函数" aria-hidden="true" class="header-anchor">#</a> this(箭头函数)</h3> <p>总是指向**<em>定义时<em><strong>所在的对象，或理解为指向</strong>所在函数</em></em>运行时的this。有这么一句话：&quot;箭头函数没有this绑定，必须通过查找作用域链来决定其值，如果箭头函数被非箭头函数包含，则this绑定的是最后一层非箭头函数的this，否则，this为undefined&quot;。</p> <h3 id="call"><a href="#call" aria-hidden="true" class="header-anchor">#</a> call</h3> <p>改变this的指向</p> <div class="language-js extra-class"><pre class="language-js"><code>fun<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">[</span><span class="token punctuation">,</span> arg1<span class="token punctuation">[</span><span class="token punctuation">,</span> arg2<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="apply"><a href="#apply" aria-hidden="true" class="header-anchor">#</a> apply</h3> <p>改变this的指向</p> <div class="language-js extra-class"><pre class="language-js"><code>fun<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token punctuation">[</span>argsArray<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="bind"><a href="#bind" aria-hidden="true" class="header-anchor">#</a> bind</h3> <p>改变this的指向，创建一个新的函数，但需要手动去调用</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// demo1</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span>
    fn<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    fnArrow<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
a<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// {name: &quot;A&quot;, fn: ƒ, fnArrow: ƒ}</span>
a<span class="token punctuation">.</span><span class="token function">fnArrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …} 因为箭头函数指向定义时的对象，此时定义在window，指向window</span>
a<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// {name: &quot;B&quot;}</span>
a<span class="token punctuation">.</span>fnArrow<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …} 因为箭头函数指向定义时的对象，此时定义在window，指向window</span>
<span class="token keyword">var</span> fn1 <span class="token operator">=</span> a<span class="token punctuation">.</span>fn
<span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token keyword">var</span> fn2 <span class="token operator">=</span> a<span class="token punctuation">.</span>fnArrow
<span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …} 因为箭头函数指向定义时的对象，此时定义在window，指向window</span>

<span class="token comment">// demo2</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'real'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    <span class="token comment">// 普通 JS</span>
    arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 箭头函数</span>
    arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'es6'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出如下：</span>
<span class="token comment">//    real {a: 100}</span>
<span class="token comment">//    js Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//    js Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//    js Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//    es6 {a: 100}</span>
<span class="token comment">//    es6 {a: 100}</span>
<span class="token comment">//    es6 {a: 100}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 输出如下：</span>
<span class="token comment">//	real Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//	js Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//	js Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//	js Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//	es6 Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//	es6 Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">//	es6 Window {postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, frames: Window, …}</span>
<span class="token comment">// 因为 fn函数只有运行后，箭头函数才会按照定义生成this指向，因此此时箭头函数定义时的所在对象恰好是fn运行时所在的对象。</span>
<span class="token comment">// 上例中的两个输出，第一个输出，因为fn运行时所指向的对象是{a: 100},因此箭头函数的定义时指向也为{a: 100};第二个输出，因为fn运行时所指向的对象是window，因此箭头函数的定义时指向也为window</span>

<span class="token comment">// demo3</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;id:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> f <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> t1 <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t2 <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> t3 <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出：</span>
<span class="token comment">// id: 1</span>
<span class="token comment">// id: 1</span>
<span class="token comment">// id: 1</span>
<span class="token comment">// 原因很简单 因为f在运行时已经确定了此时的箭头函数的定义时指向，接下来的运行时的变化将不会影响this的指向</span>

<span class="token comment">// this 对象</span>
<span class="token keyword">var</span> bob <span class="token operator">=</span> <span class="token punctuation">{</span>
    _name<span class="token punctuation">:</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span>
    _friends<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">printFriends</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_friends<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>f <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name <span class="token operator">+</span> <span class="token string">&quot; knows &quot;</span> <span class="token operator">+</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// arguments 对象</span>
<span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token function-variable function">example</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> number <span class="token keyword">of</span> arguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            numbers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>number <span class="token operator">*</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> numbers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">square</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7.5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns: [4, 16, 56,25, 64]</span>

<span class="token comment">// demo4</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;windowsName&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    name <span class="token punctuation">:</span> <span class="token string">&quot;Cherry&quot;</span><span class="token punctuation">,</span>

    func1<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>     
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    func2<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span><span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">// Cherry</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> func2<span class="token punctuation">;</span>
<span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: this.func1 is not a function</span>
</code></pre></div><h2 id="闭包"><a href="#闭包" aria-hidden="true" class="header-anchor">#</a> 闭包</h2> <p>闭包是能读取其他函数内部变量的函数</p> <p>闭包的用处：</p> <ul><li>可以读取函数内部的变量</li> <li>让变量的值始终在内存中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Mozilla'</span><span class="token punctuation">;</span> <span class="token comment">// name 是一个被init创建的局部变量</span>
    <span class="token keyword">function</span> <span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// displayName()是内部函数，一个闭包</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用了父函数中声明的变量</span>
    <span class="token punctuation">}</span>
    <span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;The Window&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
    name <span class="token punctuation">:</span> <span class="token string">&quot;My Object&quot;</span><span class="token punctuation">,</span>
    getNameFunc <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getNameFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// getNameFunc方法返回的函数是挂在window上的，所以this指向window，弹出框显示The Window</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;The Window&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
    name <span class="token punctuation">:</span> <span class="token string">&quot;My Object&quot;</span><span class="token punctuation">,</span>
    getNameFunc <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    		<span class="token keyword">return</span> that<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getNameFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  因为this指针用内部的代替了，所以返回的是My Object</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">makeCounter</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> privateCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">changeBy</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        privateCounter <span class="token operator">+=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        increment<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        decrement<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> privateCounter<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Counter1 <span class="token operator">=</span> <span class="token function">makeCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Counter2 <span class="token operator">=</span> <span class="token function">makeCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter1<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
Counter1<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Counter1<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter1<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Coutner2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
</code></pre></div><p>上例可以看出两个不同的计数器，是相互独立的。每个闭包都是引用自己的词法作用域内的变量privateCounter</p> <h2 id="作用域"><a href="#作用域" aria-hidden="true" class="header-anchor">#</a> 作用域</h2> <blockquote><p>作用域是程序源代码中定义变量的区域，是用于确定在何处以及如何查找变量(标识符)的规则</p> <p>作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限</p> <p>ECMAScript 6之前只有<strong>全局作用域</strong>和<strong>函数作用域</strong></p></blockquote> <h3 id="静态作用域-词法作用域"><a href="#静态作用域-词法作用域" aria-hidden="true" class="header-anchor">#</a> 静态作用域(词法作用域)</h3> <p>函数的作用域在函数定义的时候就决定了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fn2</span><span class="token punctuation">(</span>y <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fn1</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6 10 50</span>
</code></pre></div><p>词法作用域在书写代码时函数声明的位置就决定了。编译阶段已经能够知道全部标识符在哪里以及是如何声明的，所以词法作用域是静态的作用域，也就是词法作用域能够预测在执行代码的过程中如何查找标识符</p> <h3 id="动态作用域"><a href="#动态作用域" aria-hidden="true" class="header-anchor">#</a> 动态作用域</h3> <p>函数的作用域在函数调用的时候才决定</p> <h2 id="函数式编程"><a href="#函数式编程" aria-hidden="true" class="header-anchor">#</a> 函数式编程</h2> <p>借助数组的map方法，可以很方便的实现数组的函数式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">nextCharForNumStr</span> <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>str<span class="token punctuation">]</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">nextCharForNumStr</span><span class="token punctuation">(</span><span class="token string">' 64 '</span><span class="token punctuation">)</span> <span class="token comment">// ['A']</span>
</code></pre></div><p>这里的技巧在于，可以将需要变换的字符串，放在数组中，将对字符串的操作拆解成多个小步骤</p> <p>根据上面的思路，可以创建一个新的类型，在类型中定义map方法，实现和数组map相似的功能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Box</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> f <span class="token operator">=&gt;</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>		<span class="token comment">// 返回容器为了链式调用</span>
    fold<span class="token punctuation">:</span> f <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>			<span class="token comment">// 将元素从容器中取出</span>
    inspect<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`Box(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>	<span class="token comment">// 看容器里有什么内容</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">nextCharForNumStr</span> <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Box</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token function">nextCharForNumStr</span><span class="token punctuation">(</span><span class="token string">' 64 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a</span>
</code></pre></div><p>https://github.com/BuptStEve/blog/issues/15</p> <h2 id="js表达式-expressions-与语句-statements"><a href="#js表达式-expressions-与语句-statements" aria-hidden="true" class="header-anchor">#</a> JS表达式(expressions)与语句(statements)</h2> <p><strong>一个表达式返回一个值</strong>，可以在任何需要值的地方使用表达式，也就是，会在我们使用它的地方期望得到一个值。举例如调用function中的参数(arguments)，或者声明=的右边都属于expressions的位置</p> <p>下面的每一行都是一个expression</p> <div class="language-js extra-class"><pre class="language-js"><code>myvar
<span class="token number">100</span> <span class="token operator">+</span> x
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>可以粗略的将一个语句描述为<strong>一个行为</strong>，循环结构和if语句就是语句的例子。程序基本上是一系列语句的结合(<strong>基础声明除外</strong>)，如在MDN中定义的if语句</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
	statement1
<span class="token punctuation">[</span><span class="token keyword">else</span>
	statement2<span class="token punctuation">]</span>
</code></pre></div><p>当JavaScript需要编写一条语句时，均可以写入一个表达式，这样的语句称为<strong>表达式语句</strong>，例如在<code>statement1</code>的地方写入一个<code>function</code>，这个function就称为<code>expression statement</code>，属于特殊的statement，这个function自然可以return一个值，同事也可以在内部产生一些<code>side effect</code>，不过如果我们重点放在<code>side effect</code>部分时，通常会返回<code>undefined</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// undefined</span>
<span class="token comment">// hello</span>
</code></pre></div><blockquote><p>通常一个statement是独立的，只会完成某项任务，不过如果它影响了整个程序，例如：改变了内部的状态，或者影响后面的statement，这些造成的改变就称为side effect(副作用)</p></blockquote> <p>但不能编写一条语句来代替表达式。如，if语句不能成为函数的参数</p> <p>总结下关系:</p> <ul><li>syntax
<ul><li>statements
<ul><li>expression statements</li></ul></li> <li>expressions</li></ul></li></ul> <p>有些语句和表达式之间是有相似的功能的。</p> <h3 id="if条件语句和条件运算符-三元运算符"><a href="#if条件语句和条件运算符-三元运算符" aria-hidden="true" class="header-anchor">#</a> if条件语句和条件运算符(三元运算符)</h3> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// if语句和条件运算符</span>
<span class="token keyword">var</span> x<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    x <span class="token operator">=</span> <span class="token operator">-</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 条件运算符</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">?</span> y <span class="token punctuation">:</span> <span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等号和封号之间的代码是一个表达式。括号不是必要的，括号是为了是代码更加清晰易懂</span>
</code></pre></div><h3 id="封号和逗号运算符"><a href="#封号和逗号运算符" aria-hidden="true" class="header-anchor">#</a> 封号和逗号运算符</h3> <p>封号用来连接不同的语句</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>逗号运算符计算两个表达式的值并返回第二个表达式的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span> <span class="token comment">// 输出 'b'</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span>
x <span class="token comment">// 输出 'b'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出 b</span>
</code></pre></div><p>存在某些expressions看起来很像是statements。e.g.</p> <h3 id="对象字面量-object-literal-和块级作用域-block"><a href="#对象字面量-object-literal-和块级作用域-block" aria-hidden="true" class="header-anchor">#</a> 对象字面量(object literal)和块级作用域(block)</h3> <p>对象字面量，属于expression，用来产生一个对象，e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>object literal是一个通过<code>{}</code>与<code>,</code>逗号分隔的键值对列表，如<code>var o = {name: 'Object'}</code>写法</p></blockquote> <p>同时，上述代码是一个合法的语句，它具备：</p> <ul><li>代码块：花括号中的一系列语句</li> <li>标签：在任意语句前添加标签，这里的标签是foo</li> <li>语句：表达式语句bar(3, 5)</li></ul> <p>{}可用于定义作用域或对象字面量</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">'string'</span> <span class="token comment">// '1string'</span>
<span class="token number">1</span> <span class="token operator">+</span> undefined <span class="token comment">// NaN</span>
<span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">null</span> <span class="token comment">// 1</span>
<span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token comment">// '12, 3'</span>
<span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'reyshieh'</span><span class="token punctuation">}</span> <span class="token comment">// '1[object Object]'</span>
<span class="token comment">// 通过上面的示例，得知，除了undefined和null，基本上js会把对象先&quot;toString()&quot;再相加</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ''</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// '1, 2, 3'</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Object]'</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// [object Object]</span>

<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 0</span>
</code></pre></div><p>这两个语句返回结果不一样。第二个语句的加号左边相当于一个代码块({})，后面加上一个[]，所以返回0</p> <p>Javascript允许一个块级作用域既不充当循环也不充当if语句的一部分而独立存在。e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 该例可以通过标签命名块级作用域，并在合适的时机跳出这个作用域，返回到上层作用域中</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>printTwo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    priting<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;One&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>printTwo<span class="token punctuation">)</span> <span class="token keyword">break</span> printing<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// One</span>
<span class="token comment">// Three</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// One</span>
<span class="token comment">// Two</span>
<span class="token comment">// Three</span>
</code></pre></div><p>从上面验证了<code>{}</code>语法如果遇到statements的位置，就会被当做statements，如果在expressions的位置就会被当成一个值</p> <h3 id="函数表达式-function-expression-和函数声明-function声明"><a href="#函数表达式-function-expression-和函数声明-function声明" aria-hidden="true" class="header-anchor">#</a> 函数表达式(function expression)和函数声明(function声明)</h3> <p>下面是一个<code>function expression</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>可以在这个表达式上加一个名字，将它变成命名后的函数表达式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>命名后的函数表达式和函数声明仅从语句上是无法区分的(放在<code>=</code>右边是expression)，但效果截然不同</p> <ul><li>函数表达式产生一个值(函数)</li> <li>函数声明是一个动作：创建一个变量，其值是函数</li></ul> <p>如果需要立即调用函数，必须使用函数表达式，不能使用函数声明</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="使用对象字面量和函数表达式作为语句"><a href="#使用对象字面量和函数表达式作为语句" aria-hidden="true" class="header-anchor">#</a> 使用对象字面量和函数表达式作为语句</h3> <p>因为有些表达式和语句无法区分开，意味着相同的代码由于上下文环境不同，作用也是不同的。</p> <p>为了避免歧义，JavaScript语法<strong>禁止表达式语句以大括号和关键字function开始</strong></p> <p>换句话说，就是在JavaScript认定为statement的位置，使用了expression会变成expression statement。<strong>这并不是expression，所以产生了一些特殊的{}会被当做block解释，function开头的语法会被当做函数声明</strong></p> <p>如果想写一个以这两个标记中的任何一个开始的表达式语句，应该把它<strong>放在括号里面</strong>，它不会改变它的结果，但确保它出现在只有表达式的上下文中。</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// eval </span>
<span class="token comment">// 在语句上下文中解析它所受到的参数。如果想让eval返回一个对象，则必须在对象字面量周围加上括号</span>
<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;{foo: 123}&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 123</span>
<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;({foo: 123})&quot;</span><span class="token punctuation">)</span> <span class="token comment">// {foo: 123}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 自执行函数(IIFEs)</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'abc'</span>

<span class="token comment">// 如果省略括号，则会出现语法错误(函数声明不能声明匿名函数)</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// SyntaxError</span>

<span class="token comment">// 即使添加了名字也会返回语法错误(函数声明不能被立即调用)</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// SyntaxError</span>
</code></pre></div><p>另外，还有一种方式可以保证表达式在表达式上下文中被解析的方法，即在函数声明之前添加一个一元运算符(如+或!)，但是与括号不同的是，这些符号会改变输出的表示形式:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">+</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token comment">// 输出：</span>
<span class="token comment">// hello</span>
<span class="token comment">// NaN</span>
<span class="token comment">// NaN出现正式由于+号运算undefined的结果，也可以使用void运算符：</span>
<span class="token keyword">void</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// hello</span>
<span class="token comment">// undefined</span>
</code></pre></div><h4 id="连接多个iifes"><a href="#连接多个iifes" aria-hidden="true" class="header-anchor">#</a> 连接多个IIFEs</h4> <p>要使用封号</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// TypeError: undefined is not a function</span>
<span class="token comment">// 错误原因是JavaScript认为第二行是尝试将第一行的结果作为函数调用</span>
<span class="token comment">// 解决方法是：</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// OK</span>
<span class="token comment">// 还可以使用一元运算符的操作符，可以省略封号，因为执行会自动添加封号</span>
<span class="token keyword">void</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// OK</span>
</code></pre></div><p>另外，关于JavaScript自动补上封号有几个建议</p> <ol><li>在return，break，continue，++，—五中statement中，<code>换行字符</code>可完全等于<code>;</code></li> <li>var，if，do while，for，continue，break，return，with，switch，throw，try，debugger关键字开头，以及空的statement，上一行会自动补上封号</li> <li>遇到expression statement和function expression情况非常复杂，后面请务必要加上封号</li> <li>凡<code>(</code>和<code>{</code>开头的statements前面或上一句不加非常危险</li></ol> <p>总结：</p> <ul><li>expressions: 会产生一个值，其意义就是代表一个值的表达式，例如<code>x+y</code></li> <li>statements: 完成某项任务的操作。赋值，条件判断，声明都算是statements，如<code>if (condition) {console.log('WoW')}</code></li> <li>expression statements: 属于一种statement，其产生一个值（或回传一个值），并完成某项任务。例如：x += 1或在statement执行一个side effect的函数调用</li> <li>在statements位置放入expressions要小心（即expression statement），因为JavaScript对于expression和expression statement解释行为是不一样的</li> <li>下面两种语法对于其位置尤其需要注意
<ul><li>function
<ul><li>statement位置：当作函数声明，即创建一个值为function的变量，不能立即调用（除了加()）</li> <li>expression位置：为function expression产生一个为function的值，可以被立即调用(IIFE)</li></ul></li> <li>{}
<ul><li>statement位置：block，一个程序块，如for，label块。不能作为对象（除了加()）</li> <li>expression位置：对象实体，建一个值，对象</li></ul></li></ul></li></ul> <p>引自:</p> <p>https://segmentfault.com/a/1190000004565693</p> <p>http://2ality.com/2012/09/expressions-vs-statements.html</p> <h2 id="变量提升"><a href="#变量提升" aria-hidden="true" class="header-anchor">#</a> 变量提升</h2> <p>JavaScript中，函数及变量的声明都将被提升到函数的最顶部</p> <p>JavaScript中，变量可以在使用后声明，也就是变量可以先使用再声明</p> <blockquote><p>注意：JavaScript初始化不会被提升</p> <p>JavaScript只有声明的变量会提升，初始化不会</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 初始化x</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// 初始化y</span>
elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
elem<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token comment">// 5 7</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 初始化 x</span>

elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查找元素 </span>
elem<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> y<span class="token punctuation">;</span>           <span class="token comment">// 5 undefined</span>

<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// 初始化 y，因为是初始化，不会被提升，导致上面的y是一个未定义的变量</span>
</code></pre></div></blockquote> <p><strong>在严格模式(strict mode)下，不允许使用未声明的变量</strong></p> <p>变量提升只对var命令声明的变量有效，如果一个变量不是用var命令声明的，就不会发生变量提升</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// ReferenceError: b is not defined</span>
</code></pre></div><p><strong>ES6引入块级作用域，块级作用域中使用let声明的变量同样会提升，只不过不允许在实际声明语句前使用</strong></p> <p>函数提升同样会将声明提升至作用域头部，不过不同于变量提升，函数同样会将函数体定义提升至头部</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 编译器修改</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在创建创建步骤中，JavaScript解释器会通过function关键字识别出函数声明并且将其提升至头部；函数的生命周期会将声明、初始化、赋值三个步骤都提升到作用域头部</p> <h3 id="javascript的解析机制"><a href="#javascript的解析机制" aria-hidden="true" class="header-anchor">#</a> JavaScript的解析机制</h3> <p>遇到script标签，js就进行预解析，将变量var和function声明提升，但不会执行function，然后进入上下文执行，上下文执行还是执行预解析同样操作，直到没有var和function，再开始执行上下文</p> <p>在JavaScript中，所有绑定的声明会在控制流到达它们出现的作用域时被初始化，这里的作用域就是<code>执行上下文(Execution Context)</code>，每个执行上下文分为<code>内存分配(Memory Creation Phase)</code>与<code>执行(Execution)</code>两个阶段。</p> <p>在内存分配阶段会进行变量创建，即开始进入了<code>变量的生命周期</code>；变量的生命周期包含<code>声明(Declaration phase)</code>、<code>初始化(Initialization phase)</code>、<code>赋值(Assignment phase)</code>三个过程。其中声明步骤会在作用域中注册变量，初始化步骤负责为变量分配内存并且创建作用域绑定。此时变量被初始化为undefined</p> <p>ES6中的let与const关键字声明的变量会在作用域头部被初始化，不过这些变量仅允许在实际声明之后使用。在作用域头部与变量实际声明处之间的区域称为<code>暂时死域(Temporal Dead Zone)</code>，TDZ能避免传统的提升引起的潜在问题。</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code>a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>预解析：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a<span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="函数作用域"><a href="#函数作用域" aria-hidden="true" class="header-anchor">#</a> 函数作用域</h3> <p>存在一个很常见的问题，粒度过大，在使用闭包或者其他特性时导致异常的变量传递，如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 这里的 i 被提升到了当前函数作用域头部</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callbacks<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>callbacks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>callbacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>callbacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//6</span>
<span class="token comment">// 因为函数作用域内的i是全局作用域中的，此时i已经被污染了，变成了3</span>
</code></pre></div><h3 id="块级作用域"><a href="#块级作用域" aria-hidden="true" class="header-anchor">#</a> 块级作用域</h3> <p>类似于if、switch条件选择或者for、while这样的循环体即是所谓的块级作用域。在ES5中，要实现块级作用域，即需要在原来的函数作用域上包裹一层，即在需要限制变量提升的地方手动设置一个变量来替代原来的全局变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里的 i 仅归属于该函数作用域</span>
        callbacks<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
callbacks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
callbacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">;</span>
callbacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre></div><p>在ES6中，可以直接利用<code>let</code>关键字达成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里的 i 属于当前块作用域</span>
    callbacks<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> i <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
callbacks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
callbacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span>
callbacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">4</span>
</code></pre></div><h3 id="函数表达式"><a href="#函数表达式" aria-hidden="true" class="header-anchor">#</a> 函数表达式</h3> <p>使用函数表达式的方式不存在函数提升，因为函数名称使用变量表示的，只存在变量提升。即函数表达式也会先声明函数名，然后赋值匿名函数给它</p> <p>e.g.</p> <p>例1</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">getName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ?</span>
</code></pre></div><p>按照正常思维，可能会认为返回的是1。但实际上，getName是变量，变量的声明将提升到顶部，而变量的赋值依然保留在原来的位置。注意，函数优先，虽然函数声明和变量声明都会提升，但是函数会首先被提升，然后才是变量，提升后为</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//函数、变量声明提升后</span>
<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//函数声明提升到顶部</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> getName<span class="token punctuation">;</span>    <span class="token comment">//变量声明提升</span>
<span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//变量赋值依然保留在原来的位置</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最终输出：2</span>
</code></pre></div><p>例2</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sayHello</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">hello</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hello!</span>
</code></pre></div><p>例3</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sayHello</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// VM3376:5 Uncaught TypeError: hello is not a function</span>
</code></pre></div><h3 id="函数声明"><a href="#函数声明" aria-hidden="true" class="header-anchor">#</a> 函数声明</h3> <p>相同命名的函数，后者将会覆盖前者</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Hey!</span>
</code></pre></div><h3 id="避免使用全局变量"><a href="#避免使用全局变量" aria-hidden="true" class="header-anchor">#</a> 避免使用全局变量</h3> <ul><li><p>函数自执行</p> <p>解决避免全局变量，可以用自执行创建一个新的作用域，这样变量就不会相互污染</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>win<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> doc <span class="token operator">=</span> win<span class="token punctuation">.</span>document<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>模块化</p></li></ul> <h3 id="作用域中的名称"><a href="#作用域中的名称" aria-hidden="true" class="header-anchor">#</a> 作用域中的名称</h3> <p>在JavaScript中，作用域中的名称有以下四种</p> <ol><li>语言自身定义：所有的作用域默认都会包含this和arguments</li> <li>函数形参：函数有名字的形参会进入到函数体的作用域中</li> <li>函数声明：通过function foo() {}的形式</li> <li>变量声明：通过var foo的形式</li></ol> <p>名称解析顺序就是按照以上排序进行。</p> <h2 id="promise"><a href="#promise" aria-hidden="true" class="header-anchor">#</a> Promise</h2> <p>promise是代表了异步操作最终完成或者失败的对象</p> <ul><li>一个promise可能有三种状态：等待(pending)、已完成(fulfilled)、已拒绝(rejected)</li> <li>一个promise的状态只能从&quot;等待&quot;转到&quot;完成&quot;态或者&quot;拒绝&quot;态，不能逆向转换，同时&quot;完成&quot;态和&quot;拒绝&quot;态不能相互转换</li> <li>promise必须实现then方法</li></ul> <h2 id="立即执行函数，模块化，命名空间"><a href="#立即执行函数，模块化，命名空间" aria-hidden="true" class="header-anchor">#</a> 立即执行函数，模块化，命名空间</h2> <h3 id="立即执行函数-iife"><a href="#立即执行函数-iife" aria-hidden="true" class="header-anchor">#</a> 立即执行函数(IIFE)</h3> <p>e.g.</p> <p>例1</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// or</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>
</code></pre></div><p>前面讲解了expressions和statements，如果是函数声明，此时代表的是statements，expression statements是不允许以<code>function</code>或者<code>{</code>开头的，解析时会抛异常，所以函数声明的立即执行函数是必须加上括号的。但如果函数变量赋值，就不需要加括号，因为此时是expression</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> a<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a <span class="token comment">// 1</span>
</code></pre></div><p>除了括号以外，还可以使用二元运算符开头达到同样效果，如在函数声明前增加<code>~</code>、<code>+</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">~</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 代码</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
<span class="token operator">+</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 代码</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在例1中，观察细致的朋友应该会发现，传入的参数多了一个<code>undefined</code>，这是为啥？</p> <blockquote><p>因为在IIFE执行时，实参只有一个，形参有两个，自然undefined会被赋值为undefined</p> <p>为了防止特殊值undefined被恶意代码篡改：低版本浏览器，undefined是支持被修改的，因此</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>wall <span class="token operator">===</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>会得到你不想要的答案</p> <p>多增加一个形参，目的就是为了防止恶意修改。只要在这个IIFE作用域内，undefined就能正常获取</p> <p>其次，如果将undefined作为形参，压缩工具就可以对这些定义进行压缩，减小文件体积</p></blockquote> <h4 id="放大模式"><a href="#放大模式" aria-hidden="true" class="header-anchor">#</a> 放大模式</h4> <p>在作用域内对传入的形参进行判断，如果非空，在原有的对象基础上叠加新功能，再将新对象返回，可以将一个冗长的对象代码段拆分成多个小代码段进行加载，同时可以重复var声明，因为取得最后一个将会是完整的对象</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> rey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token constant">REY</span><span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token constant">REY</span> <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token constant">REY</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定方法say</span>
    <span class="token constant">REY</span><span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">REY</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> rey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> rey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token constant">REY</span><span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token constant">REY</span> <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token constant">REY</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定方法whoIam</span>
    Rey<span class="token punctuation">.</span><span class="token function-variable function">whoIam</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    reutrn <span class="token constant">REY</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> rey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调用</span>
rey<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rey<span class="token punctuation">.</span><span class="token function">whoIam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="宽放大模式"><a href="#宽放大模式" aria-hidden="true" class="header-anchor">#</a> 宽放大模式</h4> <p>在实参部分，第二参数为<code>window.rey || (window.rey = {})</code></p> <p>该模式也同样可以把大文件切分成多个小文件加载，不必考虑文件加载的先后顺序，不存在强耦合关系</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token constant">REY</span><span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">REY</span><span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> window<span class="token punctuation">.</span>rey <span class="token operator">||</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>rey <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token constant">REY</span><span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">REY</span><span class="token punctuation">.</span><span class="token function-variable function">whoIam</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> window<span class="token punctuation">.</span>rey <span class="token operator">||</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>rey <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="分文件加载iife要注意"><a href="#分文件加载iife要注意" aria-hidden="true" class="header-anchor">#</a> 分文件加载IIFE要注意</h4> <p>前面讲解expressions和statements时介绍过，如果多个IIFEs连接时，必须要在两个IIFE之间添加<code>;</code>，否则在执行的时候，会把第一个IIFE当做函数调用名下一个IIFE的<code>()</code>内容当做实参，导致代码报错</p> <p>解决这个问题，可以在IIFE最前面添加一个<code>;</code>，这样就防止了这类事情的发生</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token constant">REY</span><span class="token punctuation">,</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">REY</span><span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> window<span class="token punctuation">.</span>rey<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>rey <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="模块"><a href="#模块" aria-hidden="true" class="header-anchor">#</a> 模块</h3> <h4 id="立即执行函数-闭包"><a href="#立即执行函数-闭包" aria-hidden="true" class="header-anchor">#</a> 立即执行函数+闭包</h4> <p>立即执行函数可以创建作用域，闭包可以读取其他函数的变量。结合两者，可以做一个不受别的作用域影响的函数</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> privateName <span class="token operator">=</span> <span class="token string">'inner'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">privateFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'私有函数'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> privateName<span class="token punctuation">,</span>
        sayName<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// inner</span>
module<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// inner</span>
</code></pre></div><h2 id="递归"><a href="#递归" aria-hidden="true" class="header-anchor">#</a> 递归</h2> <h3 id="递归调用栈"><a href="#递归调用栈" aria-hidden="true" class="header-anchor">#</a> 递归调用栈</h3> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 该方法可以查看每一次当前的调用栈的状态</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>现在观察调用栈。第一次打印</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 调用栈包含了一个factorial函数的调用，这里是factorial(3)</span>
console<span class="token punctuation">.</span>trace
factorial @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span> @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">10</span>
</code></pre></div><p>第二次打印</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 调用栈中出现了两个函数的调用</span>
<span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">2</span> console<span class="token punctuation">.</span>trace
factorial @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">2</span>
factorial @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">7</span>
<span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span> @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">10</span>
</code></pre></div><p>第三次打印</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 调用栈中出现了三个函数的调用</span>
<span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">2</span> console<span class="token punctuation">.</span>trace
factorial @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">2</span>
factorial @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">7</span>
factorial @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">7</span>
<span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span> @ <span class="token constant">VM3766</span><span class="token punctuation">:</span><span class="token number">10</span>
</code></pre></div><p>可以看出，如果传入的参数特别大，那调用栈将会变得非常大，最终可能超出调用栈的缓存大小而崩溃导致执行失败。解决这个问题，应该使用<code>尾递归</code></p> <h3 id="尾调用"><a href="#尾调用" aria-hidden="true" class="header-anchor">#</a> 尾调用</h3> <p>当一个函数执行时的最后一个步骤是返回另一个函数的调用，就是尾调用</p> <p>函数的调用方式可以是以下几种方式</p> <ul><li>函数调用：func(...)</li> <li>方法调用: Obj.method(...)</li> <li>call调用：func.call(...)</li> <li>apply调用：func.apply(...)</li></ul> <p>并且只有以下表达式包含尾调用:</p> <ul><li><p>条件操作符：? ：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> x <span class="token operator">=&gt;</span> x <span class="token operator">?</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// f() 和 g()都在尾部</span>
</code></pre></div></li> <li><p>逻辑或：||</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// g()有可能是尾调用，f()不是</span>
<span class="token comment">// 等价</span>
<span class="token keyword">const</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fResult <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fResult <span class="token comment">// 不是尾调用</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 尾调用</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 只有当f()的结果为falsy时，g()才是尾调用</span>
</code></pre></div></li> <li><p>逻辑与：&amp;&amp;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// g()有可能是尾调用，f()不是</span>
<span class="token comment">// 等价</span>
<span class="token keyword">const</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fResult <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不是尾调用</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 尾调用</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 只有当f()的结果为truthy时，g()才是尾调用</span>
</code></pre></div></li> <li><p>逗号：,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// g()是尾调用</span>
<span class="token comment">// 等价</span>
<span class="token keyword">const</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="尾调用优化"><a href="#尾调用优化" aria-hidden="true" class="header-anchor">#</a> 尾调用优化</h3> <p>函数在调用的时候会在调用栈(call stack)中存有记录，每一条记录叫做一个调用帧(call frame)，每调用一个函数就向栈中push一条记录，函数执行结束后一次向外弹出，直到清空调用栈</p> <p><strong>尾调用优化只在严格模式下有效</strong></p> <p>尾调用由于是函数的最后一步操作，所以不需要保留外层函数的调用记录，只要直接用内层函数的调用记录取代外层函数的调用就可以，调用栈中始终只保持一条调用帧，从而节省很大一部分的内存，这就是尾调用优化的意义</p> <h3 id="尾递归"><a href="#尾递归" aria-hidden="true" class="header-anchor">#</a> 尾递归</h3> <p>尾递归是一种递归的写法，可以避免不断的将函数压栈最终导致堆栈溢出。</p> <p>修改之前的函数</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> total <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> total
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">*</span> total<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>按照理想情况，上述例子应该不再需要多次对factorial进行压栈处理，因为每一个递归调用都不在依赖于上一个递归调用的值，空间复杂度为o(1)而不是o(n)</p> <p>但是在chrome中调试，发现第三次压栈后</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span>trace
factorial @ <span class="token constant">VM5050</span><span class="token punctuation">:</span><span class="token number">3</span>
factorial @ <span class="token constant">VM5050</span><span class="token punctuation">:</span><span class="token number">8</span>
factorial @ <span class="token constant">VM5050</span><span class="token punctuation">:</span><span class="token number">8</span>
<span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span> @ <span class="token constant">VM5050</span><span class="token punctuation">:</span><span class="token number">11</span>
</code></pre></div><p>不仅仅是<code>chrome</code>，<code>firefox</code>、<code>nodejs低版本</code>的均没有开启尾调用优化</p> <p>在<code>safari</code>里进行了尾调用优化</p> <p>在Nodejs v6以下，可以通过开启<code>strict mode</code>，并使用<code>--harmony_tailcalls</code>来开启尾递归优化</p> <p>node新版本已经移除了--harmony_tailcalls功能</p> <p>e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>

<span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> total <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> total
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">*</span> total<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">// 使用命令</span>
<span class="token comment">// node --harmony_tailcalls factorial.js</span>
</code></pre></div><p>调用栈信息永远只有一个在堆栈中</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span>trace
factorial @ <span class="token constant">VM5050</span><span class="token punctuation">:</span><span class="token number">3</span>
</code></pre></div><p>总结：</p> <ul><li><p>尾递归不一定会将代码执行速度提高；相反，可能会变慢</p></li> <li><p>尾递归可以使用更少的内存，让递归函数更加安全</p></li></ul> <h2 id="混合对象类"><a href="#混合对象类" aria-hidden="true" class="header-anchor">#</a> 混合对象类</h2> <h3 id="构造函数-constructor"><a href="#构造函数-constructor" aria-hidden="true" class="header-anchor">#</a> 构造函数(constructor)</h3> <p>每个原型都有一个constructor属性指向关联的构造函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'reyshieh'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Person<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person <span class="token operator">===</span> Person<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>Person是构造函数，使用new创建一个实例对象person</p> <h4 id="new内部机制"><a href="#new内部机制" aria-hidden="true" class="header-anchor">#</a> new内部机制</h4> <ol><li>创建新对象，同时继承对象类的原型，即Person.prototype</li> <li>执行对象类的构造函数，同时该实例的属性和方法被this引用，即this指向新构造的实例</li> <li>如果构造函数return了一个新的&quot;对象&quot;，这个对象会取代整个new出来的结果。如果构造函数没有return对象，机会返回步骤1创建的对象，即隐式返回this</li></ol> <p>代码阐述</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// let p = new Person()；</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> Person<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    <span class="token comment">//其他赋值语句 ...</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="继承多种方式"><a href="#继承多种方式" aria-hidden="true" class="header-anchor">#</a> 继承多种方式</h3> <h4 id="借用构造函数-经典继承"><a href="#借用构造函数-经典继承" aria-hidden="true" class="header-anchor">#</a> 借用构造函数(经典继承)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'rey'</span><span class="token punctuation">,</span> <span class="token string">'shieh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Parent<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child1<span class="token punctuation">.</span>names<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'cain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['rey', 'shieh', 'cain']</span>
<span class="token keyword">var</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['rey', 'shieh']</span>
</code></pre></div><p>问题：</p> <ol><li><p>避免了引用类型的属性被所有实例共享</p></li> <li><p>可以在Child中向Parent传参</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Parent<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'rey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'rey'</span>
<span class="token keyword">var</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'shieh'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'shieh'</span>
</code></pre></div></li></ol> <h4 id="组合继承-原型链继承-经典继承"><a href="#组合继承-原型链继承-经典继承" aria-hidden="true" class="header-anchor">#</a> 组合继承(原型链继承+经典继承)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Parent<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Parent<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Child<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Child<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Child<span class="token punctuation">;</span>

<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'kevin'</span><span class="token punctuation">,</span> <span class="token string">'18'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

child1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// kevin</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;black&quot;]</span>

<span class="token keyword">var</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'daisy'</span><span class="token punctuation">,</span> <span class="token string">'20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// daisy</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;]</span>
</code></pre></div><p>优点:融合原型链继承和经典继承的优点，最常用的继承模式</p> <p>##原型</p> <h3 id="原型继承"><a href="#原型继承" aria-hidden="true" class="header-anchor">#</a> 原型继承</h3> <p>####原型链继承</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'reyshieh'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Parent<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Child<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reyshieh</span>
</code></pre></div><p>问题:</p> <ol><li>引用类型的属性被所有实例共享</li> <li>在创建Child的实例时，不能向Parent传参</li></ol> <h4 id="原型式继承"><a href="#原型式继承" aria-hidden="true" class="header-anchor">#</a> 原型式继承</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createObj</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token constant">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Object.create的模拟实现，将传入的对象作为创建的对象的原型</p> <p>缺点：包含引用类型的属性值始终都会共享响应的值，跟原型链继承一样</p> <h2 id="消息队列和事件循环"><a href="#消息队列和事件循环" aria-hidden="true" class="header-anchor">#</a> 消息队列和事件循环</h2> <p>Javascript是单线程语言，受限于需要和用户互动，以及操作DOM。因此，所有任务需要排队，前一个任务结束，才会执行下一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等待</p> <p>我们可以将这些任务分为<strong>同步任务(synchronous)<strong>和</strong>异步任务(asynchronous)<strong>两种。同步任务指在</strong>主线程</strong>上排队执行的任务，只有前一个任务执行完毕，才能执行下一个任务；异步任务指不进入主线程，进入**任务队列(task queue)**的任务，只有&quot;任务队列&quot;通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行</p> <p>除了主线程，还存在其他的线程，如：处理Ajax请求的线程、处理DOM事件的线程、定时器线程、读写文件的线程等</p> <p><img src="http://www.reyshieh.com/assets/event-loop.png" alt="event-loop"></p> <p>异步执行的运行机制如下：</p> <ol><li>所有同步任务在主线程上执行，形成一个执行栈(execution context stack)</li> <li>主线程之外，还存在一个&quot;任务队列&quot;。只要异步任务有了运行结果，就在&quot;任务队列&quot;之中放置一个事件</li> <li>&quot;执行栈&quot;中的所有同步任务执行完毕，就会读取&quot;任务队列&quot;。对应的异步任务结束等待状态，进入执行栈，开始执行</li> <li>主线程不断循环第三步</li></ol> <p>&quot;任务队列&quot;可以放置定时事件，主要由setTimeout()和setInterval()两个函数来完成</p> <p>HTML5标准规定setTimeout()的第二个参数的最小值(最短间隔)，不得低于4毫秒，如果低于这个值，就会自动增加。对于那些DOM的变动，通常不会立即执行，而是每16毫秒执行一次。这时使用requestAnimationFrame()的效果要好于setTimeout()</p> <p><strong>setTimeout()只是将事件插入了&quot;任务队列&quot;，必须等到当前执行栈执行完，主线程才会去执行指定的回调函数。要是当前代码耗时很长，就需要等待很久，事件没有办法保证</strong></p> <p>###Nodejs的事件循环</p> <p>在nodejs中，事件循环的运行机制会不同于浏览器环境</p> <p><img src="http://www.reyshieh.com/assets/node-event-loop.png" alt="node-event-loop"></p> <p>运行机制如下</p> <ol><li>V8引擎解析JavaScript脚本</li> <li>解析后的代码，调用Node API</li> <li><a href="http://libuv.org" target="_blank" rel="noopener noreferrer">libuv库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>负责Node API的执行。将不同的任务分配给不同的线程，形成一个EventLoop，以异步的方式将任务的执行结果返回给V8引擎</li> <li>V8引擎再将结果返回给用户</li></ol> <p>Node.js不仅提供了setTimeout()和setInterval()两个方法，还有另外两个：process.nextTick()和setImmediate()</p> <ul><li>process.nextTick()方法指定的任务总是发生在所有异步任务之前</li> <li>setImmediate()方法是在当前&quot;任务队列&quot;的尾部添加事件，也就是指定的任务总是在下一次EventLoop时执行</li></ul> <p>理解宏任务和微任务，先举个例子</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>正确的执行顺序是：script start, script end, promise1, promise2, setTimeout</p> <p>但实际在不同的浏览器里执行出来的效果是不一样的</p> <h3 id="宏任务（macrotask-task）"><a href="#宏任务（macrotask-task）" aria-hidden="true" class="header-anchor">#</a> 宏任务（macrotask/task）</h3> <p>浏览器为了使JS内部task与DOM任务能够有序执行，会在一个task执行结束后，在下一个task执行之前，对页面进行重新渲染（task -&gt; 渲染 -&gt; task -&gt; ...）</p> <p>**setTimeout的作用是等待给定的时间后为它的回调产生一个新的宏任务。**这就是为什么'setTimeout'在'script end'之后打印，因为打印 'script end'是第一个宏任务里的事情，而'setTimeout'是另一个独立的任务里打印的</p> <h3 id="微任务（microtasks-jobs）"><a href="#微任务（microtasks-jobs）" aria-hidden="true" class="header-anchor">#</a> 微任务（microtasks/jobs）</h3> <p>微任务通常就是需要在当前task执行结束后立即执行的任务，如对一些动作反馈，并不需要分配一个新的task，而只是异步的立即执行任务，这样便可以减小一点性能的开销。</p> <p><strong>只要执行栈中没有其他的js代码正在执行且宏任务执行完，微任务队列会立即执行。</strong></p> <p>如果在微任务执行期间微任务队列加入了新的微任务，会将新的微任务加入队列尾部，之后也会执行。</p> <h3 id="宏任务、微任务实例"><a href="#宏任务、微任务实例" aria-hidden="true" class="header-anchor">#</a> 宏任务、微任务实例</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>outer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>inner<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> outer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.outer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> inner <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.inner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mutate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>outer<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    attributes<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    outer<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-random'</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
inner<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> onClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
outer<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> onClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>结果如下：</p> <p>click promise mutate click promise mutate timeout timeout</p> <h2 id="多进程浏览器"><a href="#多进程浏览器" aria-hidden="true" class="header-anchor">#</a> 多进程浏览器</h2> <ul><li>浏览器是多进程的</li> <li>系统给浏览器进程都会分配资源(cpu、内存)</li> <li>每打开一个Tab页，就相当于创建了一个独立的浏览器进程</li></ul> <p>浏览器包括这些进程</p> <ul><li><strong>Browser进程</strong> - 浏览器主进程（负责协调、主控），只有一个
<ul><li>负责浏览器界面显示，与用户交互。如前进、后退等</li> <li>负责各个页面的管理，创建和销毁其他进程</li> <li>将Renderer进程得到的内存中的Bitmap，绘制到用户界面上</li> <li>网络资源的管理、下载等</li></ul></li> <li><strong>第三方插件进程</strong></li> <li><strong>GPU进程</strong> - 最多一个，用于绘制3D等</li> <li><strong>浏览器渲染进程（浏览器内核）</strong>（Renderer进程，内部是多线程的）：默认每个Tab页面一个进程，互不影响
<ul><li>页面渲染</li> <li>脚本执行</li> <li>事件处理</li></ul></li></ul> <p>之所以多进程，原因</p> <ul><li>避免单个页面 crash，影响整个浏览器</li> <li>避免第三方插件 crash影响整个浏览器</li> <li>多进程充分利用多核优势</li> <li>方便使用沙盒模型隔离插件等进程，提高浏览器稳定性</li> <li>如果浏览器是单进程，那么某个Tab崩溃了，就会影响到整个浏览器，体验差；插件崩溃了，也会影响到整个浏览器</li></ul> <h3 id="浏览器内核（渲染进程）"><a href="#浏览器内核（渲染进程）" aria-hidden="true" class="header-anchor">#</a> 浏览器内核（渲染进程）</h3> <p>主要完成：</p> <ul><li>页面的渲染</li> <li>JS的执行</li> <li>事件的循环</li></ul> <p><strong>渲染进程是多线程的</strong></p> <ul><li>GUI渲染线程
<ul><li>负责渲染浏览器界面，解析HTML、CSS，构建DOM树和RenderObject树，布局和绘制等</li> <li>当界面需要重绘(Repaint)或由某种操作引发回流(reflow)时，线程就会执行</li> <li>**GUI渲染线程与JS引擎线程是互斥的。**当JS引起执行时GUI线程会被挂起，GUI更新会被保存在一个队列中等到JS引擎空闲时立即被执行</li></ul></li> <li>JS引擎线程
<ul><li>JS内核，负责处理JavaScript脚本程序（如V8引擎）</li> <li>JS引擎线程负责解析JavaScript脚本，运行代码</li> <li>JS引擎一直等待着任务队列中任务的到来，然后加以处理，一个Tab页（renderer进程）中有且只有一个JS线程在运行JS程序</li> <li>如果JS执行的时间过长，会造成页面的渲染不连贯，导致页面渲染加载阻塞</li></ul></li> <li>事件触发线程
<ul><li><strong>归属于浏览器</strong>而不是JS引擎，用来控制事件循环</li> <li>当JS引擎执行代码块如setTimeout时，(或来自浏览器内核的其他线程，如鼠标点击、AJAX异步请求等)，会将对应任务添加到事件线程中</li> <li>当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理</li> <li>由于JS是单线程，所以这些待处理了队列中的事件都得排队等待JS引擎处理（Event Loop）</li></ul></li> <li>定时触发器线程
<ul><li>setInterval和setTimeout所在线程</li> <li>浏览器定时计数器并不是由Javascript引擎计数的</li> <li>通过单独线程来计时并触发定时（Event Loop）</li></ul></li> <li>异步http请求线程
<ul><li>在XMLHttpRequest连接后通过浏览器新开一个线程请求</li> <li>将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调放入事件队列中。再给到JavaScript引擎执行</li></ul></li></ul> <h4 id="browser进程和浏览器内核（renderer进程）通信"><a href="#browser进程和浏览器内核（renderer进程）通信" aria-hidden="true" class="header-anchor">#</a> Browser进程和浏览器内核（Renderer进程）通信</h4> <p>每次打开一个浏览器，任务管理器中会出现两个进程（<strong>一个是主控进程，另一个是打开Tab页的渲染进程</strong>）。</p> <ul><li>Browser进程收到用户请求，首先需要获取页面内容（如通过网络下载资源），将该任务通过RendererHost接口传递给Render进程</li> <li>Renderer进程的Renderer接口收到消息，交给渲染进程，然后开始渲染
<ul><li>渲染线程接收到请求，加载网页并渲染网页，也许需要Browser进程获取资源和需要GPU进程来帮助渲染</li> <li>也会有JS线程操作DOM，有可能会造成回流重绘</li> <li>Render进程将结果传递给Browser进程</li></ul></li> <li>Browser进程接收到结果并将结果绘制出来</li></ul> <h4 id="浏览器内核中线程之间的关系"><a href="#浏览器内核中线程之间的关系" aria-hidden="true" class="header-anchor">#</a> 浏览器内核中线程之间的关系</h4> <ul><li><p>GUI渲染线程与JS引擎线程互斥</p> <p>JavaScript是可操作DOM的，如果在修改元素属性同时渲染界面（即JS线程与UI线程同时运行），渲染线程前后获得的元素数据就可能不一致了</p> <p>为了防止渲染出现不可预期的结果，浏览器设置GUI渲染线程与JS引擎为互斥的关系，当JS引擎执行时GUI线程会被挂起，GUI更新则会被保存在一个队列中等到JS引擎线程空闲时立即被执行</p></li> <li><p>JS阻塞页面加载</p> <p>如果JS引擎中有巨大的计算量，此时GUI有更新，也会被保存到队列中，等待JS引擎空闲后执行。就会导致页面变得十分卡</p> <p>要尽量避免JS执行时间过长，这样会造成页面的渲染不连贯，导致页面渲染加载阻塞的感觉</p> <p>为了解决这个问题，HTML5引入了<strong>Web Worker</strong></p> <ol><li>创建worker时，JS引擎向浏览器申请开一个子线程（子线程是浏览器开的，完全受主线程控制，而且不能操作DOM）</li> <li>JS引擎线程与worker线程间通过特定的方式通信(postMessage API，序列化对象来与线程交互特定的数据)</li></ol> <p>因为Web Worker是线程级的，只能在当前Render进程中使用。为了能让Worker可以在所有页面中共享，又引入了<strong>SharedWorker</strong>，二者区别</p> <ul><li>WebWorker只属于某个页面，不会和其他页面的Render进程共享。</li> <li>SharedWorker是浏览器所有页面共享的，不能采用与WebWorker一样的实现机制，不属于某个Render进程，可以为多个Render进程共享使用。因此，在浏览器中每个相同的JavaScript只存在一个SharedWorker进程，不管被创建多少次</li> <li>因此，WebWorker属于Render进程下的一个线程；SharedWorker属于独立的进程管理</li></ul></li></ul> <h4 id="浏览器渲染流程"><a href="#浏览器渲染流程" aria-hidden="true" class="header-anchor">#</a> 浏览器渲染流程</h4> <p>渲染之前操作，浏览器输入url，浏览器主进程接管，打开下载线程，进行Http请求，然后等待响应，获取内容，随后将内容通过RenderHost转交给Render进程。之后开始渲染流程</p> <ul><li>解析html建立DOM树</li> <li>解析CSS构建CSSOM</li> <li>结合DOM和CSSOM，生成render树</li> <li>布局render树(Layout/reflow)，负责各元素尺寸、位置计算</li> <li>绘制render树（Paint），绘制页面像素信息</li> <li>浏览器将各层的信息发送给GPU，GPU将各层合成（composite），显示在屏幕上</li></ul> <h5 id="load事件与domcontentloaded事件先后"><a href="#load事件与domcontentloaded事件先后" aria-hidden="true" class="header-anchor">#</a> load事件与DOMContentLoaded事件先后</h5> <ul><li>DOMContentLoaded事件触发时，仅当DOM加载完成，不包括样式表，图片</li> <li>load事件触发时，页面上所有的DOM、样式表、脚本、图片都已经加载完成了，即渲染完毕</li></ul> <p>DOMContentLoaded -&gt; load</p> <h4 id="普通图层和复合图层"><a href="#普通图层和复合图层" aria-hidden="true" class="header-anchor">#</a> 普通图层和复合图层</h4> <p>浏览器渲染的图层分为普通图层和复合图层</p> <p><strong>普通文档流</strong>为一个复合图层（<strong>默认复合层</strong>，不管添加多少元素，都是在同一个复合图层中）；absolute、fixed布局虽然可以脱离文档流，但仍然属于默认复合层</p> <p><strong>可以通过硬件加速的方式，声明一个新的复合图层，会单独分配资源，即不管这个复合图层怎么变化，都不会影响默认复合层里的回流重绘</strong></p> <p>那么，如何才能变成复合图层呢？答案是<strong>硬件加速</strong></p> <ul><li>最常用的方式：translate3d、translateZ</li> <li>opacity属性/过渡动画（需要动画执行的过程中才会创建合成层，动画没有开始或结束后元素还会回到之前的状态）</li> <li>&lt; video&gt; &lt; iframe&gt; &lt; canvas&gt; &lt; webgl &gt;元素都会</li></ul> <p><strong>absolute和硬件加速的区别?</strong></p> <p>absolute虽然脱离普通文档流，但还是无法脱离默认复合层。所以即使absolute中信息改变也不会改变文档流中render树，但浏览器最终绘制时，是整个复合层绘制，所以absolute中信息的改变，仍然会影响整个复合层的绘制。</p> <p><strong>硬件加速时尽量使用index</strong>。基于浏览器的CSS3原理，元素添加了硬件加速，并且index层级比较低，那么在这个元素后面的其他元素(如果层级更高或者相同，并带relative或absolute属性相同)，会默认变为复合层渲染，影响性能</p> <h2 id="object-assign"><a href="#object-assign" aria-hidden="true" class="header-anchor">#</a> Object.assign()</h2> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token operator">...</span>sources<span class="token punctuation">)</span>
</code></pre></div><p>函数参数为一个目标对象(该对象作为最终的返回值)，源对象(任意多个)</p> <p>通过调用该函数可以拷贝所有可被枚举的自有属性值到目标对象中</p> <p><strong>可枚举属性由enumerable值决定</strong>。可枚举性决定了这个属性是否能被for...in查找遍历到。对象不可枚举，方法for...in，JSON.stringify()，Object.keys()都会失效</p> <p><strong>null或undefined源被视为空对象对待，不会对目标对象产生任何影响</strong></p> <p><strong>不可枚举对象也不会对目标对象产生影响</strong></p> <p><strong>如果目标对象不可写，将会引发TypeError</strong></p> <p>Object.assign不仅返回一个新拼接出来的值，同时也会改变第一个参数(target)的值，e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    bar<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">// bar是一个不可枚举的属性</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    baz<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// baz是一个可枚举属性</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> copy <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {baz: 3}</span>
</code></pre></div><h2 id="object-create"><a href="#object-create" aria-hidden="true" class="header-anchor">#</a> Object.create()</h2> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>proto <span class="token punctuation">[</span><span class="token punctuation">,</span> propertiesObject <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>该是ES5提出的对象创建方式，第一参数是要继承的原型，如果不是一个子函数，可以传入null，第二个参数是对象的属性描述符，这个参数是可选的。返回一个具有指定的内部原型且包含指定的属性（如果有）的新对象。</p> <p>满足以下任一条件，则将引发TypeError异常：</p> <ul><li>prototype参数不是对象且不为null</li> <li>descriptors参数中的描述符具有value或writable特性，并具有get或set特性</li> <li>descriptors参数中的描述符具有不为函数的get或set特性</li></ul> <p><strong>如果要停止原型链，可以使用采用了null prototype参数的函数，所创建的对象将没有原型。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Car</span> <span class="token punctuation">(</span>desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Car<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    getInfo<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'A '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">+</span> <span class="token string">'.'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//instantiate object using the constructor function</span>
<span class="token keyword">var</span> car <span class="token operator">=</span>  Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Car<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
car<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>car<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 弹出A blue undefined</span>
</code></pre></div><h2 id="object-defineproperty"><a href="#object-defineproperty" aria-hidden="true" class="header-anchor">#</a> Object.defineProperty()</h2> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span>
</code></pre></div><ul><li>Obj: 目标对象</li> <li>prop: 需要定义的属性或方法的名字</li> <li>descriptor: 目标属性所拥有的特性</li></ul> <h3 id="特性特性"><a href="#特性特性" aria-hidden="true" class="header-anchor">#</a> 特性特性</h3> <ul><li>value：属性的值</li> <li>writable：是否可以随意重写</li> <li>configurable：是否能删除或被删除</li> <li>enumerable：是否能for...in循环遍历或Object.keys中列举出来</li> <li>get：目标属性被访问就会调用此方法，并将方法的运算结果返回用户</li> <li>set：目标属性被赋值，就会调用此方法</li></ul> <h2 id="类型化数组-typed-arrays"><a href="#类型化数组-typed-arrays" aria-hidden="true" class="header-anchor">#</a> 类型化数组(Typed Arrays)</h2> <p>一些新功能，如音视频编辑、访问WebSockets的原始数据等，直接对原始的二进制数据操作会更加快速</p> <p>类型数组将实现拆分为<strong>缓冲</strong>和<strong>视图</strong>两部分</p> <ul><li><p>缓冲 - 由ArrayBuffer对象实现，描述的是一个数据块</p></li> <li><p>视图 - 为了访问在缓冲对象中包含的内存，不要使用视图。视图提供了上下文，即数据类型、起始偏移量和元素数，将数据转换为实际有类型的数组</p> <p><img src="http://www.reyshieh.com/assets/arraybuffer.png" alt="arraybuffer"></p></li></ul> <h3 id="arraybuffer"><a href="#arraybuffer" aria-hidden="true" class="header-anchor">#</a> ArrayBuffer</h3> <p>是一种数据类型，用来表示一个通用的、固定长度的二进制数据缓冲区。不能直接操纵ArrayBuffer中的内容，需要创建一个类型化数组或一个描述缓冲数据格式的DataView，使用它们来读写缓冲区中的内容</p> <h3 id="类型数组视图"><a href="#类型数组视图" aria-hidden="true" class="header-anchor">#</a> 类型数组视图</h3> <p>类型化数组视图具有自描述行的名字和所有常用的数值类型，如Int8、Uint32、Float64等</p> <p>使用e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> int32View <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int32Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>int32View<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	int32View<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Entry &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span><span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> int32View<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Entry 1:2</span>
<span class="token comment">// Entry 2:4</span>
<span class="token comment">// Entry 3:6</span>

<span class="token keyword">var</span> int16View <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int16Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>int16View<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Entry &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span><span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> int16View<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Entry 0:0</span>
<span class="token comment">// Entry 1:0</span>
<span class="token comment">// Entry 2:2</span>
<span class="token comment">// Entry 3:0</span>
<span class="token comment">// Entry 4:4</span>
<span class="token comment">// Entry 5:0</span>
<span class="token comment">// Entry 6:6</span>
<span class="token comment">// Entry 7:0</span>
</code></pre></div><blockquote><p>ArrayBuffer对比Blob？</p></blockquote> <p>Blob是Binary Large Object(大型二进制对象)的缩写。代表原始的二进制数据。和ArrayBuffer类似，都是二进制数据的容器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 可以用字符串构建Blob</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'rey shieh'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ArrayBuffer</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以看出，ArrayBuffer是Blob的底层，Blob内部使用了ArrayBuffer。并且构造好的一个Blob实体就是一个raw data。为什么要设计Blob和ArrayBuffer？ArrayBuffer更底层，所以专注细节，比如说按字节读写文件；Blob更像一个整体，就是一个原始的Binary Data，只要来回传输就行</p> <blockquote><p>blob和ArrayBuffer使用？</p></blockquote> <p>在HTML5中，file对象的内部就是使用Blob，从&lt; input &gt;标签中获取的File对象即使一个Blob实例</p> <p>blob文件的转换，可以使用FileReader对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fd有几个文件读取方法，可以得到ArrayBuffer、Blob或String数据</span>

<span class="token comment">// 使用ArrayBuffer读取方式，得到一个ArrayBuffer实例</span>
fd<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用blob的方式，得到一个blob对象</span>
fd<span class="token punctuation">.</span><span class="token function">readAsBinaryString</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

fd<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取成功后得到ArrayBuffer</span>
    buffer <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将一个blob文件以ArrayBuffer的形式进行读取，得到一个ArrayBuffer的实例，目的为何？因为这样就可以对文件的字节进行读写，比如要判断一个文件的类型，就可以读取它的前两个字节，与Hash表进行匹配等</p> <p>在实际数据交互中，发送的数据往往是Binary Data，很少需要使用ArrayBuffer按byte来手动构造数据</p> <p>这么解释，blob和ArrayBuffer就都有存在的必要了</p> <p>blob除了以上，还可以构造URL</p> <p>URL对象的createObjectURL方法允许传入一个blob，得到一个临时的URL</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">URI</span> <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">cerateElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URI</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>如何实现Blob与ArrayBuffer、TypeArray和字符串String之间转换？</p></blockquote> <ul><li><p>将字符串转换成Blob对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'rey shieh'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'text/plain'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>blob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>将TypeArray转换成Blob对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>array<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将Blob对象读成字符串</span>
reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a Hello world!</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ArrayBuffer转Blob</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>buffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>将Blob对象转换成String字符串，使用FileReader的<code>readAsText</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'rey shieh'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'text/plain'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将Blob对象转换成字符串</span>
<span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>将Blob对象转换成ArrayBuffer，使用FileReader的<code>readAsArrayBuffer</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'rey shieh'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'text/plain'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>将文件转换成Blob，使用FileReader的<code>readerAsBinaryString</code>方法</p></li></ul> <h3 id="转换为普通数组"><a href="#转换为普通数组" aria-hidden="true" class="header-anchor">#</a> 转换为普通数组</h3> <p>可以使用<code>Array.from</code>，或者<code>Array.prototype.slice.call(typedArray)</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> typedArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    normalArray <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>typedArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
normalArray<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">;</span>
normalArray<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：在计算机中字节序的排序存在大端(big endian)和小端(little endian)。这里采用的是大端，即地址最低位到最高位存储的数据为真实数据的高位到低位，因此存在下面这个例子的问题</p> <div class="language- extra-class"><pre class="language-text"><code>var arraybuffer = new ArrayBuffer(4);
var aView = new Int8Array(arraybuffer);  //从0开始到内存末尾
var bView = new Int16Array(arraybuffer,2); //从2开始到末尾

aView[0] = 1;
aView[1] = 2;
aView[2] = 3;
aView[3] = 4;

bView[0] = 500;
bView[1] = 8;

console.log(aView[2] );      //return   -12
console.log(aView[3] );      //return   1
</code></pre></div><p>500在计算机中二进制表示为 00000001 11110100</p> <p>aView是有符号8位数组，11110100代表的是-12</p> <p>根据大端的存储规则，aView[2]代表的是-12，aView[3]代表的是1</p> <p>如果将上面的aView改为Uint8Array，如下</p> <div class="language- extra-class"><pre class="language-text"><code>var arraybuffer = new ArrayBuffer(4);
var aView = new Uint8Array(arraybuffer);  //从0开始到内存末尾
var bView = new Int16Array(arraybuffer,2); //从2开始到末尾

aView[0] = 1;
aView[1] = 2;
aView[2] = 3;
aView[3] = 4;

bView[0] = 500;
bView[1] = 8;

console.log(aView[2] );      //return   244
console.log(aView[3] );      //return   1
</code></pre></div></blockquote> <h2 id="memoization"><a href="#memoization" aria-hidden="true" class="header-anchor">#</a> Memoization</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">memoize</span><span class="token punctuation">(</span>fundamental<span class="token punctuation">,</span> cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache <span class="token operator">=</span> cache <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">shell</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache<span class="token punctuation">[</span>arg<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fundamental</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>arg<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> shell<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="原码、反码、补码、移码"><a href="#原码、反码、补码、移码" aria-hidden="true" class="header-anchor">#</a> 原码、反码、补码、移码</h2> <h3 id="原码"><a href="#原码" aria-hidden="true" class="header-anchor">#</a> 原码</h3> <p>原码是符号位加上真值的绝对值，即用第一位表示符号，其余位表示值，以8位二进制：</p> <div class="language- extra-class"><pre class="language-text"><code>[+1]原 = 0000 0001
[-1]原 = 1000 0001
</code></pre></div><p>取值范围</p> <div class="language- extra-class"><pre class="language-text"><code>[1111 1111, 0111 1111]
即
[-127, 127]
</code></pre></div><h3 id="反码"><a href="#反码" aria-hidden="true" class="header-anchor">#</a> 反码</h3> <p>正数的反码是其本身；负数的反码是在其原码的基础上，符号位不变，其余各位取反</p> <div class="language- extra-class"><pre class="language-text"><code>[+1]原 = [0000 0001]原 = [0000 0001]反
[-1]反 = [1000 0001]原 = [1111 1110]反
</code></pre></div><h3 id="补码"><a href="#补码" aria-hidden="true" class="header-anchor">#</a> 补码</h3> <p>正数的补码是其本身；<strong>负数的补码是在其原码的基础上，符号位不变，其余各位取反，最后+1</strong>（即在反码的基础上+1）</p> <div class="language- extra-class"><pre class="language-text"><code>[+1]原 = [0000 0001]原 = [0000 0001]反 = [0000 0001]补
[-1]反 = [1000 0001]原 = [1111 1110]反 = [1111 1111]补
</code></pre></div><p><strong>补码用于解决计算机的减法运算问题</strong>，因为原码计算减法算出的结果是错误的，反码算出的结果0会带上-，但实际这个符号是没有任何意义的</p> <div class="language- extra-class"><pre class="language-text"><code>1-1 = 1+(-1) = [0000 0001]原 + [1000 0001]原 = [0000 0001]补 + [1111 1111]补 = [0000 0000]补 = [0000 0000]原

(-1) + (-127) = [1000 0001]原 + [1111 1111]原 = [1111 1111]补 + [1000 0001]补 = [1000 0000]补
因为[1000 0000]补代表的是-128，使用的是-0的补码表示出来的，所以-128并没有原码和反码表示
</code></pre></div><p><strong>使用8位二进制，原码或反码表示的范围[-127, +127]，补码表示的范围[-128, 127]</strong></p> <p>32位int类型，表示范围是[-2^31, 2^31-1]</p> <h4 id="js中的按位非"><a href="#js中的按位非" aria-hidden="true" class="header-anchor">#</a> JS中的按位非(~)</h4> <p>实际该符号操作只需记住公式 <strong>任意数值x进行按位非操作的结果为-(x + 1)</strong>，即~5结果为-6</p> <p>计算步骤为（e.g. ~1）</p> <ul><li>将1转二进制 = 0000 0001</li> <li>按位取反 = 1111 1110</li> <li>接下来采用补码逻辑 = 1000 0010</li> <li>转换为十进制 = -2</li></ul> <p>接着举例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4.9</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//4.9</span>
n <span class="token operator">=</span> <span class="token operator">~</span>n<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
n <span class="token operator">=</span> <span class="token operator">~</span>n<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//-4</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~null: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// =&gt; -1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~undefined: '</span><span class="token punctuation">,</span> <span class="token operator">~</span>undefined<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; -1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~0: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// =&gt; -1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~{}: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// =&gt; -1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~[]: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// =&gt; -1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~(1/0): '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; -1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~false: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; -1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~true: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// =&gt; -2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~1.2543: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token number">1.2543</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// =&gt; -2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~4.9: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token number">4.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// =&gt; -5</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~(-2.999): '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// =&gt; 1</span>
</code></pre></div><p>~~x，可以用这个方法代理parseInt(value)，而且效率更加高效 e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~null: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// =&gt; 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~undefined: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span>undefined<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~0: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// =&gt; 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~{}: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// =&gt; 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~[]: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// =&gt; 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~(1/0): '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~false: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~true: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// =&gt; 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~1.2543: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token number">1.2543</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// =&gt; 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~4.9: '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token number">4.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// =&gt; 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~(-2.999): '</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// =&gt; -2</span>
</code></pre></div><p>为什么带小数位会去除？</p> <h3 id="移码"><a href="#移码" aria-hidden="true" class="header-anchor">#</a> 移码</h3> <p>移码是将补码的符号位取反即可</p> <div class="language- extra-class"><pre class="language-text"><code>[+1]原 = [0000 0001]原 = [0000 0001]反 = [0000 0001]补 = [1000 0001]移
[-1]反 = [1000 0001]原 = [1111 1110]反 = [1111 1111]补 = [0111 1111]移
</code></pre></div><p><strong>移码表示法是在数x上增加一个偏移量来定义的，常用来表示浮点数中的阶码，所以是整数</strong></p> <p>如果机器字长为n，规定偏移量为2^(n-1)。若x是整数，则x移 = 2^(n-1) + x。e.g.</p> <div class="language- extra-class"><pre class="language-text"><code>[+1]移 = [1000 0000] + [0000 0001]补 = [1000 0001]移
[-1]反 = [1000 0000] + [1111 1111]补 = [0111 1111]移
</code></pre></div><h2 id="字符编码"><a href="#字符编码" aria-hidden="true" class="header-anchor">#</a> 字符编码</h2> <h3 id="ascii码"><a href="#ascii码" aria-hidden="true" class="header-anchor">#</a> ASCII码</h3> <p>一个字节一共可以用来表示256中不同的状态，每一个状态对应一个符号，就是256个符号，从<code>0000 0000</code>到<code>1111 1111</code></p> <p><code>ASCII码</code>一共规定了128个字符的编码，比如空格<code>SPACE</code>是32(二进制0010 0000)</p> <h3 id="unicode"><a href="#unicode" aria-hidden="true" class="header-anchor">#</a> Unicode</h3> <p>Unicode让每一种符号都给予一个独一无二的编码，就不会出现乱码问题，这是一种所有符号的编码</p> <p>Unicode是分区定义的。每个区可以存放65536个(2^16)字符，称为一个平面（plane）。目前，一共有17个(1+2^4)平面。所以整个Unicode字符集的大小现在为2^21</p> <p>上面提到的17个平面，包括1个基本平面(BMP)，码点从0到2^16 - 1，写成16进制就是从U+0000到U+FFFF；剩下的为辅助平面(SMP)，码点从U+010000到U+10FFFF</p> <h3 id="utf-8"><a href="#utf-8" aria-hidden="true" class="header-anchor">#</a> UTF-8</h3> <p>UTF-8是Unicode的实现方式之一</p> <p>它是一种变长的编码方式，可以使用1-4个字节来表示一个符号，根据不同的符号而变化字节长度</p> <p>UTF-8的编码规则有两个:</p> <ul><li>对于单字节的符号，字节的第一位设为0，后面7位为符号的Unicode码。因此，英语字母，UTF-8和ASCII码是相同的</li> <li>对于n字节的符号(n &gt; 1)，第一个字节的前n位都设为1，第n+1为设为0，后面字节的前两位一律设为10。剩下位数填Unicode码</li></ul> <table><thead><tr><th>Unicode符号范围(十六进制)</th> <th>UTF-8编码方式(二进制)</th></tr></thead> <tbody><tr><td>0000 0000 - 0000 007F</td> <td>0xxx xxxx</td></tr> <tr><td>0000 0080 - 0000 07FF</td> <td>110x xxxx 10xx xxxx</td></tr> <tr><td>0000 0800 - 0000 FFFF</td> <td>1110 xxxx 10xx xxxx 10xx xxxx</td></tr> <tr><td>0001 0000 - 0010 FFFF</td> <td>1111 0xxx 10xx xxxx 10xx xxxx 10</td></tr></tbody></table> <h3 id="utf-32"><a href="#utf-32" aria-hidden="true" class="header-anchor">#</a> UTF-32</h3> <p>UTF-32编码采用的是字节意义对应码点的方式，该种方式最为简单，但是<strong>浪费空间，比形同ASCII编码文件大四倍</strong>比如码点0，用四个字节的0表示，码点597D就在前面加上两个字节的0</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 以下为16进制</span>
<span class="token constant">U</span><span class="token operator">+</span><span class="token number">0000</span> <span class="token operator">=</span> <span class="token number">0x0000</span> <span class="token number">0000</span>
<span class="token constant">U</span><span class="token operator">+</span><span class="token number">597</span>D <span class="token operator">=</span> <span class="token number">0x0000</span> <span class="token number">597</span>D
</code></pre></div><p>但是也有优点，<strong>查找效率高，时间复杂度o(1)</strong></p> <p>但因为致命的缺点，导致实际上没有人使用这种编码方式</p> <h3 id="utf-16"><a href="#utf-16" aria-hidden="true" class="header-anchor">#</a> UTF-16</h3> <p>UTF-16编码介于UTF-8和UTF-32之间，同时结合了定长和变长两种编码方法的特点</p> <p>规则为：<strong>基于基本平面的字符占用2个字节，辅助平面的字符占用4个字节</strong></p> <p>因此，<strong>UTF-16的编码长度很好区分，U+0000到U+FFFF为2个字节，U+010000到U+10FFFF为4个字节</strong></p> <p>但是，在UTF-16中，要如何区分2个字节和4个字节的解读呢？</p> <p>在基本平面中，存在U+D800到U+DFFF是一个空段，即这些码点不对应任何字符。因此，就可以用这些空段来做文章</p> <p><strong>辅助平面因为字符总共需要20位来表示，可以将这20位拆分成两段，前10位映射在U+D800到U+DBFF（空间大小为2^10），称为高位(H)，后10位映射在U+DC00到U+DFFF（空间大小2^10），称为低位（L）</strong></p> <p>所以当遇到两个字节，发现码点在U+D800到U+DBFF之间，就可以断定，紧跟在后面的两个字节的码点，应该在U+DC00到U+DFFF之间，四个字节要放在一起解读</p> <h3 id="ucs-2"><a href="#ucs-2" aria-hidden="true" class="header-anchor">#</a> UCS-2</h3> <p>JavaScript也采用Unicode字符集，但是使用的编码方式为UCS-2</p> <p>UCS-2实际上就是用2个字符表示码点的字符，而UTF-16取代了UCS-2，可以借助辅助平面用4个字节表示字符</p> <p>因为<strong>在JavaScript语言出现的时候，还没有UTF-16编码，所以采用的是UCS-2</strong></p> <p>正因如此，JavaScript对所有字节的处理都是2个字节，如果是4个字节的字符，会当做两个双字节的字符处理，导致无法返回正常的结果</p> <p>为了解决无法表示4字节字符的问题，必须通过对码点进行判断，然后手动调整，可以如下操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 遍历字符串，对码点进行判断，只要码点落在0xD800到0xDBFF之间，就连同后面2个字节一起读取</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>index <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>charCode <span class="token operator">&gt;=</span> <span class="token number">0xD800</span> <span class="token operator">&amp;&amp;</span> charCode <span class="token operator">&lt;=</span> <span class="token number">0xDBFF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>character <span class="token operator">+</span> string<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token operator">++</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>character<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>JavaScript在ECMAScript6到来之前，所有的字符操作函数都存在这个问题，诸如</p> <div class="language-js extra-class"><pre class="language-js"><code>String<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
String<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
String<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
</code></pre></div><h4 id="es6中的unicode"><a href="#es6中的unicode" aria-hidden="true" class="header-anchor">#</a> ES6中的Unicode</h4> <p>ES6自动识别4个字节的码点。遍历字符串就简单多了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> s <span class="token keyword">of</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但为了保持兼容，length属性还是原来的行为方式。为了得到字符串的正确长度，可以用<code>Array.from(string).length</code></p> <p>JavaScript允许直接用码点表示Unicode字符，写法为<code>&quot;反斜杆+u+码点&quot;</code>，如</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'好'</span> <span class="token operator">===</span> <span class="token string">'\u597D'</span> <span class="token comment">// true</span>
</code></pre></div><p>在原来的JS中，这种表示方法对4字节的码点是无效的。ES6可以把码点放在大括号中，正确表示，如</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'𝌆'</span> <span class="token operator">===</span> <span class="token string">'\u{1D306}'</span> <span class="token comment">// true</span>
<span class="token string">'𝌆'</span> <span class="token operator">===</span> <span class="token string">'\u1D306'</span> <span class="token comment">// false</span>
</code></pre></div><p>ES6中还新增了几个专门处理4字节码点的函数</p> <div class="language-js extra-class"><pre class="language-js"><code>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 从Unicode码点返回对应字符</span>
String<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 从字符返回对应的码点</span>
String<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回字符串给定位置的字符</span>
</code></pre></div><h3 id="unicode复合显示"><a href="#unicode复合显示" aria-hidden="true" class="header-anchor">#</a> Unicode复合显示</h3> <p><img src="http://www.reyshieh.com/assets/Unicode-composite.png" alt="Unicode-composite"></p> <p>有些字符除了主体字符外，会和附加符号组合显示成一个码点，即两个码点表示一个字符</p> <p>但是，个别情况下，Unicode提供了两种表示方法。一种是带附加符号的单个字符，即一个码点表示一个字符，如Ǒ的码点是U+01D1；另一种是将附加符号单独作为一个码点，与主体字符符合显示，比如Ǒ可以写成O（U+004F） + ˇ（U+030C）</p> <p>两种表达方式表示的字符是相同的，但是在JavaScript中无法辨别</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'\u01D1'</span><span class="token operator">===</span><span class="token string">'\u004F\u030C'</span> <span class="token comment">//false</span>
</code></pre></div><p>ES6提供了normalize方法，允许&quot;Unicode正规化&quot;，即两种方法转为同样的序列</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'\u01D1'</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'\u004F\u030C'</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="算法"><a href="#算法" aria-hidden="true" class="header-anchor">#</a> 算法</h2> <h3 id="排序算法"><a href="#排序算法" aria-hidden="true" class="header-anchor">#</a> 排序算法</h3> <ul><li>稳定 - a在b前，且a=b，排序后仍然a在b前</li> <li>不稳定 - a在b前，且a=b，排序后a可能出现在b后</li> <li>内排序 - 所有排序操作在内存中完成</li> <li>外排序 - 数据太大，会把数据放在磁盘中，排序要通过磁盘和内存的数据传输才能进行</li> <li>时间复杂度 - 算法执行所耗费的时间</li> <li>空间复杂度 - 运行完一个程序所需内存的大小</li></ul> <p><img src="http://reyshieh.com/assets/sort-algorithms.png" alt="sort-algorithms"></p> <h5 id="冒泡排序-bubble-sort"><a href="#冒泡排序-bubble-sort" aria-hidden="true" class="header-anchor">#</a> 冒泡排序(Bubble sort)</h5></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/knowledge-note/knowledge/review-the-javascript.html" class="prev">
          ES6
        </a></span> <span class="next"><a href="/knowledge-note/knowledge/Damn-hole-of-design-patterns.html">
          设计模式
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/knowledge-note/assets/js/18.6f16dec0.js" defer></script><script src="/knowledge-note/assets/js/app.a571e02f.js" defer></script>
  </body>
</html>
